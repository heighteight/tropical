
\subsubsection{The language $\BSTLC$}
In Section 4 we considered a variant $\BSTLC$ of $\STLC$ with linear simple types and a graded exponential $!_{n}A$, for all $n\in \BB N$, corresponding to a somehow simplified version of the language $\mathrm{Fuzz}$ \cite{Reed2010}. 
%The terms are generated by the grammar:
%
%{
%\begin{minipage}{\textwidth}
%\begin{align*}
%M:= x\mid \lambda x.M\mid MM \mid !M \mid \mathsf{let}\  !x=M \ \mathsf{in}\  M%\mid (t,u)\mid  \mathsf{let}\  (x,y)=t \ \mathsf{in} \  u 
%\end{align*}\end{minipage}}\medskip\\
%For the purposes of this article we limited ourselves to a minimal fragment of this language. For a more practical language see \cite{Reed2010,Gaboardi2017}.  


The types are generated by the grammar below:


{
\begin{minipage}{\textwidth}
\begin{align*}
A:= X \ \mid  \ !_{n}A \multimap A
\end{align*}\end{minipage}}\medskip\\
Type judgements are of the form $\Gamma \vdash t:A$, where a context $\Gamma$ is a list of declarations of the form $x :_{n}A$, with $n\in \BB N$.
We define the following operation $\Gamma+\Delta$  as follows:

{
\begin{minipage}{\textwidth}
\begin{align*}
() + () & =() \\
(\Gamma, x:_{m} A)+( \Delta, x:_{n} A) & =  (\Gamma+\Delta), x:_{m+n}A \\
(\Gamma, x:_{n}A)+\Delta & =(\Gamma+\Delta), x:_{n}A \qquad (x\notin \Delta) \\
\Gamma+ (\Delta, x:_{n}A) &= (\Gamma+\Delta), x:_{n} A \qquad (x\notin \Gamma)
\end{align*}\end{minipage}}\medskip\\
Moreover, we let $m\Gamma$ be the context made all judgements $x:_{mn}A$, where $(x:_{n}A): \Gamma$.  

The typing rules of $\BSTLC$ are illustrated in Fig.~\ref{fig:fuzz}.

%Observe that one can always type an affine term like e.g.~$\lambda xy.x$ with a linear type $A\multimap B\multimap A$. Instead, a term like $\lambda xy.x(xy)$ containing two occurrences of $x$ cannot be given the linear type $(A\multimap A)\multimap (A\multimap A)$ but a type of the form
%$!_{2}(A\multimap A)\multimap (A\multimap A)$. 







\begin{figure}
\fbox{
\begin{minipage}{0.9\textwidth}
\begin{center}

  {
\AXC{}
\UIC{$ x:_{1}A\vdash x: A$}
\DP}

\bigskip

\begin{tabular}{c c }
\AXC{$\Gamma \vdash M:A$}
\UIC{$\Gamma, x:_{0}B \vdash M:A$}
\DP

&

\AXC{$\Gamma, x:_{n}B, y_{m}:B\vdash M:A$}
\UIC{$\Gamma, x:_{n+m}B\vdash M[x/y]:A$}
\DP

\\

& 

\\

  {
\AXC{$\Gamma, x:_{n} A\vdash M: B$}
\UIC{$\Gamma\vdash \lambda x.M: !_{n}A\multimap B$}
\DP}

& 

  {
\AXC{$\Gamma \vdash M: A\multimap B$}
\AXC{$\Delta\vdash N: A$}
\BIC{$\Gamma +\Delta\vdash MN: B$}
\DP}
\\ 

%& 

%\\
%
%  {
%\AXC{$\Gamma \vdash t\in A$}
%\AXC{$\Delta \vdash u\in B$}
%\BIC{$\Gamma+\Delta \vdash ( t,u) \in A\otimes B$}
%\DP}
%
%& 
%
%
%  {
%\AXC{$\Gamma\vdash t\in A \otimes B$}
%\AXC{$\Delta,x\in_{n}A, y\in_{n} B\vdash u:C$}
%\BIC{$n\Gamma+\Delta \vdash \mathsf{let}\  (x,y)=t \ \mathsf{in}  \ u\in C$}
%\DP}
%\\
%& 

%\\
%
%
%
%
%
%& 
%
%  {
%\AXC{$\Gamma\vdash M: !_{n}A$}
%\AXC{$\Delta,x\in_{mn}A\vdash u:C$}
%\BIC{$m\Gamma+\Delta \vdash \mathsf{let}\  !x=M \ \mathsf{in} \ u :  C$}
%\DP}


\end{tabular}

\bigskip

  {
\AXC{$\Gamma \vdash M: A$}
\UIC{$n\Gamma \vdash M : \ !_{n}A$}
\DP}

\end{center}
\end{minipage}
}
\caption{Typing rules for $\BSTLC$.}
\label{fig:fuzz}
\end{figure}





\subsubsection{$(\LREL, !_{n})$ is a model of $\BSTLC$}

Given SMCs $\C C,\C D$,  let $\B{SMC}_{l}(\C C, \C D)$ indicate the category of symmetric lax monoidal functors and monoidal natural transformations between them.
$\B{SMC}_{l}(\C C, \C D)$  is itself a SMC, with monoidal structure defined pointwise.

The set 
$\BB N$ can be seen as the category with objects the natural numbers and a morphism between $r$ and $r'$ precisely when $r\leq r'$. 
Moreover, $\BB N$ can be seen as a SMC in two ways:
\begin{itemize}

\item we indicate as $\BB N^{+}$ the SMC with monoidal product given by addition;
\item we indicate as $\BB N^{\times}$ the SMC with monoidal product given by multiplication.
\end{itemize}


%Below we let $\BB^{\min}$ indicate the monoid $(Q,\min,0)$ and $\Lawv^{+}$ indicate the monoid $(Q,+,0)$.

\begin{definition}[cf.~\cite{Katsumata2018}]
A \emph{$\BB N$-graded linear exponential comonad} on a symmetric monoidal category $\C C$ is a tuple
$(D, w,c,\epsilon,\delta)$ where:
\begin{itemize}

\item $D: \BB N\to \B{SMC}_{l}(\C C, \C C)$ is a functor. We write 
$m_{r}:\{\star\} \to D(r)(\{\star\})$ and $m_{r,A,B}: D(r)(A)\otimes D(r)(B) \to D(r)(A\otimes B)$ for the symmetric lax monoidal structure of $D(r)$;

\item $(D,w,c): \BB N^{+}\to \B{SMC}_{l}(\C C, \C C)$ is a symmetric colax monoidal functor;

\item $(D,\epsilon,\delta):\BB N^{\times}\to (\B{SMC}_{l},\mathrm{Id},\circ) $ is a colax monoidal functor.



\end{itemize}
further satisfying the axioms below:
\begin{align}
w_{A}& =  w_{D(s)(A)}\circ \delta_{0,s,A}\\
w_{A} & = D(s)(w_{A} )\circ \delta_{s,0,A} \\
(\delta_{r,s,A}\otimes \delta_{r',s,A})\circ c_{rs,r's,A}
&=
c_{r,r',D(s)(A)}\circ \delta_{r+r',s,A}\\
m_{s,D(r)(A),D(r')(A)}\circ (\delta_{r,s,A}\otimes \delta_{s,r',A})\circ c_{sr,sr',A}&=
D(s)(c_{r,r',A})\circ \delta_{s,r+r',A}
\end{align}
\end{definition}


Concretely, the definition above requires 6 natural transformations:
\begin{align*}
m_{r} & :\{\star\}\to  D(r)(\{\star\})\\
m_{r,A,B}& :  D(r)(A)\otimes D(r)(B)\to  D(r)(A\otimes B)\\
w_{A}& : D(0)(A)\to \{\star\} \\
c_{r,r',A}& : D(r+r')(A) \to D(r)(A)\otimes D(r')(A) \\
\epsilon_{A}& : D(1)(A)\to A \\
\delta_{r,r',A}&: D(r r')(A)\to D(r)(D(r')(A))
\end{align*}
subject to the following list of equations:
\begin{itemize}
\item $D(r)$ is a lax monoidal functor:
\begin{align}
m_{r,A\otimes B,C}\circ (m_{r,A,B}\otimes D(r)(C)) & = 
m_{r,A, B\otimes C}\circ (D(r)(A)\otimes m_{r,B,C})\\
m_{r,A,\{\star\}}\circ (D(r)(A)\otimes m_{r}) & = D(r)(A)\\
m_{r,\{\star\}, B}\circ (m_{r}\otimes D(r)(B))&= D(r)(B)
\end{align}


\item $(D,w,c)$ is a symmetric colax monoidal functor:
\begin{align}
(c_{r,s,-}\otimes D(t)(-))\circ c_{r+s,t} & =
(D(r)(-)\otimes c_{s,t,-})\circ c_{r,s+t}\\
(D(r)(-)\otimes w_{-})\circ c_{r,0,-} & = D(r)(-) \\
(w_{-}\otimes D(r)(-))\circ c_{0,r,-} & = D(r)(-)
\end{align}


\item $(D,\epsilon,\delta)$ is a colax monoidal functor:
\begin{align}
\delta_{r,s, D(t)(-)}\circ \delta_{(rs),t,-} & =
D(r)(\delta_{s,t,-})\circ \delta_{r,st,-}\\
D(r)(\epsilon_{-}) \circ \delta_{r,1,-} & = D(r)(-) \\
\epsilon_{D(r)(-)} \circ \delta_{1,r,-} & = D(r)(-)
\end{align}

\end{itemize}


The following definition provides an interpretation of $\BSTLC$ in any symmetric monoidal closed category with a $\BB N$-graded linear exponential comonad.

\begin{definition}[interpretation of $\BSTLC$]
Let $\C C$ be a symmetric monoidal closed category and $(D, w,c,\epsilon,\delta)$ be a $\BB N$-graded linear exponential comonad. 
Let $\model{X}$ be fixed objects of $\C C $, one for each ground type $X$ of $\BSTLC$. 

One lifts the interpretation to types as 
$\model{!_{n}A\multimap B}=D(n)(\model{A})\multimap \model B$. Moreover, one extends the interpretation to contexts via $\model{x:_{n}A}:= D(n)(\model A)$ and 
$\model{\{x_{1}:_{n_{1}}A_{1},\dots, x_{k}:_{n_{k}}A_{k}\}}=
\bigotimes_{i=1}^{k}\model{x_{i}:_{n_{i}}A_{i}}$.

Then, one inductively defines an interpretation $\model{\Gamma \vdash M:A}\in \C C(\model\Gamma, \model A)$ of $\Gamma \vdash M:A$ by induction as follows:
 \begin{itemize}
\item $\model{x\in_{1}A\vdash x\in A}=\epsilon_{A}$;
\item $\model{\Gamma+x:_{0}B\vdash M:A} =
\model{\Gamma \vdash M:A}
\circ (\model{\Gamma}\otimes  w_{\model B})
$;
\item $\model{\Gamma, x:_{m+n}B \vdash M[x/y]:A}=
\model{\Gamma, x:_{m}B, y:_{m}B \vdash M:A}
\circ
(\model\Gamma \otimes c_{m,n,\model B})
$;
\item $\model{\Gamma \vdash \lambda x.M: !_{n}A\multimap B}=
\Lambda (\model{\Gamma, x:_{n}A \vdash M:B})
$, where $\Lambda$ is the isomorphism $ \C C(\model \Gamma \otimes D(n)(\model A), \model B) \to \C C(\model \Gamma, D(n)(\model A)\multimap \model B)$;

\item $\model{\Gamma+\Delta \vdash MN:B}=
\mathsf{ev}\circ \big( \model{\Gamma \vdash M:A\multimap B}
\otimes
\model{\Delta \vdash N:A}\big)$, where $\mathsf{ev}\in \C C((\model{A}\multimap \model B)\otimes \model A, \model B)$ is the evaluation morphism of $\C C$;


\item $\model{n\Gamma\vdash M:!_{n}A}=
 !_{n}(\model{\Gamma \vdash M:A})\circ \big(\delta_{n,m_{1},\model{A_{1}}}\otimes \dots \otimes 
\delta_{n,m_{k},\model{A_{k}}}\big)
$, where $\Gamma=\{x_{1}:_{m_{1}}A_{1},\dots, x_{k}:_{m_{k}}A_{k}\}$.
%\item $\model{m\Gamma+\Delta \vdash \mathsf{let}\ !x=M\ \mathsf{in} \ u:C}=
%\model{\Delta,x:_{mn}A\vdash u:C}
%\circ
%!_{m}(\model{\Gamma \vdash M:!_{n}A})
%$.

\end{itemize}
\end{definition}


Let us now show that bounded multisets defined a $\BB N$-graded linear exponential comonad over $\LREL$.

\begin{definition}
We define the following structure $(!_{-}(-),w,c,\epsilon,\delta)$ over the category $\LREL$ as follows:
\begin{itemize}
\item for any set $X$ and $n\in \BB N$, let $!_{n}(X)=\C M_{\leq n}(X)$;

\item for all $f: X\times Y\to \Lawv$, let $!_{n}(f): !_{n}(X)\times !_{n}(Y)\to \Lawv$ be defined by 
\begin{align*}
!_{n}(f)(\alpha,\beta)=
\begin{cases}
\min_{\sigma\in \F S_{k}}\sum_{i=1}^{k}f(x_{i},y_{\sigma(i)}) & 
\text{ if }\alpha=[x_{1},\dots, x_{k}], \beta=[y_{1},\dots, y_{k}]\\
\infty & \text{ otherwise}
\end{cases}
\end{align*}


\item $m_{r}(\star, \{\star\})=0$ and $m_{r}(\star, \emptyset)=\infty$;

\item $m_{r,A,B}: D(r)(A)\times D(r)(B)\times D(r)(A\times B)\to \Lawv$ is defined by 
\begin{align*}
m_{r,A,B}((\alpha,\beta), \gamma)=
\begin{cases}
0 & \text{ if } \alpha=[x_{1},\dots, x_{k}], \beta=[y_{1},\dots, y_{k}], \gamma= [(x_{1},y_{1}),\dots, (x_{k},y_{k})]\\
\infty & \text{ otherwise}
\end{cases}
\end{align*}

\item $w_{A}:D(0)(A)\times \{\star\}\to \Lawv$ is given by $w_{A}(\emptyset, \star)=0$ and is $\infty$ otherwise (observe that $D(0)(A)\simeq \{\star\}$);

\item $c_{r,s,A}: D(r+s)(A)\times D(r)(A)\times D(s)(A)\to \Lawv$ is given by $c_{r,r',A}(\langle\alpha, \beta,\gamma\rangle)=0$ if $\alpha=\beta+\gamma$, and is $\infty$ otherwise;

\item $\epsilon_{A}(\emptyset, a)=\infty$, $\epsilon_{A}([a],a)=0$, $\epsilon_{A}([b],a)=\infty$ $(b\neq a)$,

\item $\delta_{r,r',A}(\alpha, B)=0$ if $\alpha= \sum B$ (where $\sum B$ indicates the multiset obtained by the sum of all multisets contained in $B$) and is $\infty$ otherwise.




\end{itemize}

\end{definition}

\begin{proposition}
 $(!_{-}(-),w,c,\epsilon,\delta)$  is a $\BB N$-graded linear exponential comonad over $\LREL$.
\end{proposition}
\begin{proof}
\begin{itemize}

\item $D(r)$ is a lax monoidal functor:
 $$ m_{r,A\times B,C}\circ (m_{r,A,B}\times D(r)(C))(\langle \alpha,\beta,\gamma,\delta\rangle)
 :
 D(r)(A)\times D(r)(B)\times D(r)(C) \times D(r)(A\times B\times C)\to \Lawv
 $$
 is equal to $0$ 
precisely when $\alpha=[x_{1},\dots, x_{k}]$, $\beta=[y_{1},\dots, y_{k}]$, $\gamma=[z_{1},\dots, z_{k}]$ and 
$\delta= [(x_{1},y_{1},z_{1}),\dots, (x_{k},y_{k},z_{k})]$, and is $\infty $ in all other cases.

Observe that
$m_{r,A,B\times C}\circ (D(r)(A)\times m_{r,B,C})(\langle\alpha,\beta,\gamma, \delta\rangle)
  $ is equal to $0$ in the same situation, and is $\infty$ otherwise.
 
 We conclude that the two matrices coincide.
 
 Furthermore, we have that 
 $m_{r,A,\{\star\}}\circ (D(r)(A)\times m_{r})(\langle \alpha,\beta\rangle): D(r)(A)\times \{\star\} \times D(r)(A)$ is equal to $0$ 
 precisely when $\alpha=\beta$ and is $\infty$ otherwise, that is, it coincides with $\mathrm{id}_{D(r)(A)}$. 
 


\item $(D,w,c)$ is a symmetric colax monoidal functor.


$((c_{r,s,A}\times D(t)(A))\circ c_{r+s,t,A}) (\langle \alpha,\beta,\gamma,\delta\rangle)
: D(r+s+t)(A)\times D(r)(A)\times D(s)(A)\times D(t)(A)$
is equal to $0$ when $\alpha=\beta+\gamma+\delta$, and is $\infty$ otherwise, and the same holds for
$((D(r)(A)\times c_{s,t,A})\circ c_{r,s+t,A}) (\langle \alpha,\beta,\gamma,\delta\rangle)
$.

Furthermore, 
$((D(r)(A)\times w_{A})\circ c_{r,0,A})(\alpha,\beta)
: D(r)(A)\times D(r)(A)\to \Lawv$ is equal to $0$ when 
$\alpha=\beta$, and is $\infty$ otherwise, so it coincides with 
$\mathrm{id}_{D(r)(A)}$.

\item $(D,\epsilon,\delta)$ is a colax monoidal functor:

$(\delta_{r,s,D(t)(A)}\circ \delta_{rs,t,A})
(\alpha, \Gamma)
: D(rst)(A) \times D(r)(D(s)(D(t)(A))) \to \Lawv
$
is $0$ precisely when $\alpha = \sum \sum \Gamma$, and is $\infty$ otherwise, and similarly for 
$(D(r)(\delta_{s,t,A})\circ \delta_{r,st,A})(\alpha,\Gamma)$.


Furthermore, 
$(D(r)(\epsilon_{A})\circ \delta_{r,1})( \alpha,\beta ):
D(r)(A) \times D(r)(A)\to \Lawv
$ is equal to $0$ when $\alpha=\beta$ and is $\infty$ otherwise, so it coincides with $\mathrm{id}_{D(r)(A)}$.


\end{itemize}


Let us check the further equations:
\begin{itemize}

\item $(w_{D(s)(A)}\circ \delta_{0,s,A})(\langle \emptyset,\star\rangle: D(0)(A)\times \{\star\}\to \Lawv$ is 0, precisely like $w_{A}$.

\item A similar argument holds for the second equation.

\item $((\delta_{r,s,A}\times \delta_{r',s,a})\circ c_{rs,r's,A})
(\langle \alpha, \Gamma,\Delta  \rangle)
:
D(rs+r's)(A)\times  D(r)(s)(A)\times D(r')(s)(A)\to \Lawv
$
is equal to $0$ when $\alpha=\sum \Gamma + \sum \Delta$, and is $\infty$ otherwise.



Now, 
using the fact that $D(rs+r's)(A)=D((r+r')s)(A)$, we can check that the same holds for 
$c_{r,r',D(s)(A)}\circ \delta_{r+r',s,A})(\langle \alpha, \Gamma,\Delta  \rangle)$: it is $0$ when 
$\alpha= \sum\Gamma+\Delta= \sum \Gamma+\sum \Delta$.


\item A similar argument holds for the fourth equation.

\end{itemize}
\end{proof}

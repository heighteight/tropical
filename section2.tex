%Recall the two approaches with more details on lambda-calculus and on existing challenges.


In this section we discuss in some more detail the two approaches in quantitative semantics recalled in the Introduction, at the same time providing an overview of how we aim at bridging them using tropical mathematics.

\subsection{Metric approach: bounded $\lambda$-terms as Lipschitz functions}


As recalled in the Introduction, in many situations (typically, when dealing with computationally expensive function) one does not look for algorithms to compute some function \emph{exactly}, but rather to approximate it (e.g.~in an efficient way) within some error bound. In other common situations (typically, in differential privacy \cite{}) one needs to verify that an algorithm is not \emph{too sensitive} to errors, that is, that a small error in the input will produce a comparably small error in the output. 

A natural way to account for these situations is to consider denotational semantics in which types are endowed with a \emph{behavioral metric}, that is, a metric on programs which measures differences of behavior. 
A fundamental insight coming from this works is that \emph{affine} programs, that is, programs that may use their input at most once, correspond to \emph{non-expansive} (or $1$-Lipschitz) maps, that is, to functions $f$ for which the distances
$d(f(x),f(y))$ produced in output are bounded by the distances $d(x,y)$ in input. 
A more formal way of stating this observation is that the category $\Met$ of pseudo-metric spaces and non-expansive 
map \emph{symmetric monoidal closed}, and provides a model of the \emph{affine} simply typed $\lambda$-calculus. 

As observed in \cite{Gabo2017}, the metric approach is not restricted to affine programs, but can be extended to programs with \emph{bounded} duplications, by considering \emph{Lipschitz-continuous} functions.
For instance, the higher-order program $M=\lambda f.\lambda x.f(f(x))$, which duplicates the functional input $f$, can be interpreted as a $2$-Lipschitz map between the metric space $\BB R\multimap \BB R$ of non-expansive real functions and itself: if $f,g$ are two non-expansive maps differing by at most $\epsilon$ (i.e.~for which $|f(x)-g(x)|\leq \epsilon$ holds for all $x\in \BB R$), then the application of $M$ to $f$ and $g$ will produce two maps differing by at most $2\epsilon$. 
By observing that a $r$-Lipschitz map between metric spaces $X$ and $Y$ is the same as a non-expansive map between the \emph{re-scaled} space $r\cdot X$ (i.e.~with distance $d_{r}(x,y)=r\cdot d(x,y)$) and $Y$, the program $M$ above 
can thus be interpreted as a non-expansive map from $2\cdot(\BB R\multimap \BB R)$ to $\BB R\multimap \BB R$.

These observations have led to the study of \emph{bounded} typed $\lambda$-calculi (like the system $\mathsf{Fuzz}$ \cite{Reed_2010}),
which have been applied in the study of higher-order differential privacy \cite{}. In these calculi, which are inspired from Girard's \emph{bounded linear logic} \cite{}, function types are of the form $!_{r}X \multimap Y$, and programs are interpreted as $r$-Lipschitz maps. In categorical terms, the re-scaling operation $!_{r}(-)$ can be characterized as a  \emph{graded linear exponential comonad} \cite{}. 

Then, what about the good old, ``unbounded'', simply typed $\lambda$-calculus? Actually, by using unbounded duplications, one might lose the Lipschitz property. For instance, while the functions $M_{k}=\lambda x. k\cdot x: \BB R\to \BB R$ are all Lipschitz-continuous, with Lipschitz constant $k$, the function $M=\lambda x.x^{2}$ obtained by ``duplicating'' $x$ is not Lipschitz anymore: $M$ is, so to say, \emph{too} sensitive to errors. 
More abstractly, it is well-known that the category $\Met$ is \emph{not} cartesian closed, so it is not a model of the simply typed $\lambda$-calculus (yet, $\Met$ contains several cartesian closed \emph{sub-}categories, see e.g.~\cite{}).
Still, one might observe that the program $M$ above is actually Lipschitz-continuous, if not globally, at least \emph{locally} (i.e.~ over any compact set). However, constructing cartesian closed categories of locally Lipschitz maps is challenging. Yet, some examples exist in the literature (see \cite{EhrhardPCOHdiff, PistoneLICS2021}), and a new example will be exhibited in this paper.

% - Metric models: functions as Lipschitz maps, differential privacy.
%
%- Problem with unrestricted duplications
%
%- Bounded Linear Logic/lambda-calculus, why Met is only a model of BLL, and why it is difficult (but not impossible!) to construct models of full lambda

\subsection{Resource approach: differential $\lambda$-terms as polynomials}

The key ingredient of these approaches is a notion of \emph{linear application}, which in the syntax of the differential $\lambda$-calculus is written $\Der[M]\cdot N$: this means that $N$ is passed to $M$ so that the latter may use it exactly once. More formally, the differential operator $\Der[-]$ transforms a function $M:A\to B$ into a function $\Der[M]: A\to (A\to B)$ which is linear in its first argument. 
%Since $M$ may rather ask for several copies of $N$, this requires a form of non-determinism: 
%For example, if $M$ is the term $\lambda fx.f(fx)$ considered before, $\Der[M]$ takes a first input $N$ and passes it linearly to $M$. Notice that there are two ways of doing so, corresponding to the two bound occurrences of $f$ in $M$: either by applying $N$ to $fx$, or by 
%applying $f$ linearly to $Nx$ (indeed, if $f$ were applied in an unrestricted way, it might duplicate $Nx$, so that $N$ would not be used linearly). This justifies the equation below, in which $\Der[M]$ is identified with the non-deterministic sum of the two possible linear choices:
%\begin{align}
%\Der\left[\lambda f x.f(fx)\right]\cdot N = 
%\lambda fx. N(fx) + \left(\Der[f]\cdot (Nx)\right)(fx)
%\end{align}
More generally, one can define a notion of $k$-bounded application $\Der^{(k)}[M]\cdot N^{k}$, where $\Der^{(0)}[M]\cdot N^{0}= M$ and $\Der^{(k+1)}[M]\cdot N^{k+1}= \Der[ \Der^{(k)}[M]\cdot N^{k}]\cdot N$, corresponding to passing $N$ to $M$ exactly $k$ times.
%

The name ``differential'' for the operator $\Der[-]$ is justified by the fact that it satisfies many properties of the usual differential operator of analysis $\Der[f]:= \lambda xy. \frac{\mathsf df(y)}{\mathsf dy}\cdot x$. Notably, it is additive in its first variable (i.e.~it commutes with the non-deterministic sum operator), and satisfies the chain rule.
Most famously, the differential operator can be used to define a Taylor formula for $\lambda$-terms, which decomposes an unrestricted application into a formal non-deterministic sum of bounded applications:
\begin{align}
MN  =  \sum_{k=0}^{\infty}\frac{1}{!k}\cdot (\Der^{(k)}[M] \cdot N^{k})0
\end{align}
Now, given our previous discussion of bounded duplications and Lipschitz-continuity, a natural question would be whether the differential approach to the $\lambda$-calculus may lead to decompose an unbounded $\lambda$-term 
into a sum of Lipschitz functions, thus bridging the metric and differential approach.  
While suggestive, this idea seems to contradict the fact that, in the canonical semantics of the differential $\lambda$-calculus, the relational semantics \cite{}, the bounded terms appearing in the Taylor expansion correspond to \emph{polynomials}, and thus to non-Lipschitz functions. 


More generally, the relational semantics interprets unbounded programs as analytic functions, that is, as functions admitting a representation as power series. For instance, observing that an analytic map $f: \BB R\to \BB R$, where $f(x)=\sum_{n}\widehat f_{n}\cdot x^{n}$ is uniquely determined by the sequence $\widehat f_{n}$, the program $M_{\infty}:=\lambda fx.fx: (\BB R\To \BB R)\To (\BB R\To \BB R)$ is represented by the power series below:
\begin{align}
F_{\infty}(f,x)= \sum_{n=0}^{\infty} \widehat f_{n} x^{n}
\end{align}
By restricting ourselves to bounded applications, the terms in the power series become finite, that is, the interpretation becomes a \emph{polynomial}: for instance, the program $M_{2}:=\lambda fx. \sum_{i=0}^{2}\Der^{(i)}[f]\cdot x^{i}$, corresponding to passing $x$ \emph{at most twice} to $f$, is represented by the polynomial
\begin{align}
F_{\leq 2}(f,x)=\widehat f_{2} x^{2}  + \widehat f_{1}x +  \widehat f_{0} 
\end{align}
 In this framework the differential operator is naturally represented by formal differentiation of polynomials, where, as one would expect, 
 $\Der[\sum_{n}a_{n}x^{n}]=\sum_{n}\Der[a_{n}x^{n}]$ and $\Der[a_{0}x^{0}]=0$ and $\Der[a_{n+1}x^{n+1}]= (n+1)a_{n+1}x^{n}$, so that power series can be Taylor expanded. 
 
Going back to our previous question, we can now reformulate it as follows: can we make the relational semantics \emph{Lipschitz}, hence amenable to metric and sensitivity analysis? The goal of this paper is to show that this is indeed possible and actually quite natural, by appealing to tropical mathematics.
 
\subsection{Tropical mathematics: a possible synthesis}

{\color{red}Lista delle cose da dire:}

1) Def di quantale, come lattice e come complete idempotent semiring.
Among the the so-called \emph{tropical semirings}, we consider the \emph{Lawvere quantale/semiring}.

2) Def di $\Lawv$, the \emph{Lawvere quantale}: seen as the idempotent complete semiring, it is $(\BB R_{\geq0}\cup\set{\infty},\inf,\infty,\cdot,0)$.
Seen as lattice it is defined by the order $\preceq$, which is the reversed order $\geq$ of the usual order $\leq$ on $\BB R_{\geq0}\cup\set{\infty}$.

3) Maslov dequantisation:

First, let us recall that for any non-negative real $t$, the functions $\phi_{t}(x)=-t\log x$ and $\psi_{t}(\alpha)=e^{-\alpha/t}$ are inverse of each other and define thus continuous (w.r.t.\ the usual topologies) bijections between the space of probabilities $[0,1]$ and $\BB R_{\geq 0}\cup\set{\infty}$ (we write $\log$ for the natural logarithm).
Moreover, if we set $\alpha \widetilde+ \beta:= \frac{\alpha+\beta}{2}$, $\alpha\sumt{t}\beta=\phi_{t}(\psi_{t}(\alpha)\widetilde{+}\psi_{t}(\beta))=-\log (e^{-\alpha/t}+e^{-\beta/t})-\phi_{t}(2)$ and $\alpha\prodt{t} \beta:=\phi_{t}(\psi_{t}(\alpha)\psi_{t}(\beta))=\alpha+\beta$, it is known that: $\lim\limits_{t\to 0}\alpha\sumt{t} \beta= \min\{\alpha,\beta\}$.
In this sense, setting $\Lawv_t:=([0,\infty],\sumt{t},\prodt{t})$, one says that $\Lawv_t\to_{t\to 0^+}\Lawv$.
Moreover, setting $\widetilde\Lawv:=([0,\infty],\widetilde+,\cdot)$, it can be shown that $\Lawv_t\simeq\widetilde\Lawv$ for all $t>0$, so the $\Lawv_t$ are all isomorphic, whereas at the limit we have a discontinuity: it can be shown that $\Lawv_t\not\simeq\Lawv$.

4) Def di $\trop$ di un polinomio/serie, (\`e la stessa formula, dipende solo se gli indici sono finiti/infiniti).
Come sta scritto sotto, giusto un po' pi\`u formale (per esempio, scriverlo come Definizione).

The fundamental observation that led to the study of mathematics over the \emph{tropical semi-ring} $\Lawv=([0,\infty],\min,+)$ was that, by replacing everywhere the ``$+$'' by the ``$\min$'' and the ``$\times$'' by the ``$+$'', many algebraic and geometric objects becomes combinatorial and their computation simpler. 

For instance, the tropicalization of a cubic polynomial $p(x)=ax^{3}+bx^{2}+cx+d$ yields a piecewise-linear function 
\begin{align}
\trop p(\alpha)= \min\{ 3\alpha+a, 2\alpha+b, \alpha+c,d\}
\end{align}
Notably, the \emph{tropical roots} (whose definition is recalled in Section \ref{section3}) of $\trop p(\alpha)$ can be found through a rather simple (indeed polytime \cite{}) algorithm, and can be used to \emph{approximate} the actual roots of $p(x)$ \cite{}. 
More generally, the tropicalization of a power series $f(x)=\sum_{n}\widehat f_{n}x^{n}$ yields a \emph{tropical Laurent series} \cite{} 
\begin{align}
\trop f(\alpha)= \inf_{n}\left\{n\alpha+ \widehat f_{n}\right\}
\end{align}
a class of functions that we will study in detail in Section \ref{section4}.


\subsection{Outline of the paper}

Since polynomials correspond to piecewise linear (hence Lipschitz) functions in tropical mathematics, the reconstruction of the relational semantics over the tropical semi-ring, presented in Section \ref{section3} and Section \ref{section4}, will provide a metric semantics of the differential $\lambda$-calculus, bridging sensitivity and resource analysis. 
In Section \ref{section5} we will suggest potential applications of this approach, relating well-studied applications of program metrics, resource analysis with current uses of tropical mathematics in computer science.  
Finally, in Section \ref{section6} we will show that the connection between the metric and differential analysis of higher-order programs extends well beyond the relational semantics, through a more abstract correspondence between  
\emph{generalized metric spaces} (in the sense of Lawvere \cite{}) and modules over the tropical semi-ring.

%- generalities about tropical maths (tropicalisation $\trop P$  of polynomials and of Laurent series, and their roots -- all that without $\LREL$)








%Recall the two approaches with more details on lambda-calculus and on existing challenges.


%In this section, we discuss in some more detail the two approaches to quantitative semantics we mentioned in the Introduction, at the same time providing an overview of how we aim at bridging them using tropical mathematics.

\paragraph*{Controlled duplication/erasure via graded types: bounded $\lambda$-calculus $\BSTLC$}\label{sec:BSTLC}

One can see that the comonad $!$ of $\LREL$ can be ``decomposed'' {\color{red}REF} into a family of ``graded exponentials functors'' $!_n:\LREL\to\LREL$ ($n\in\BB N$), defined on objects by taking multisets of cardinality \emph{at most} $n$. %  lift to functors 
The sequence $(!_n)_{n\in\N}$ gives rise to a so-called \emph{$\N$-graded linear exponential comonad} on (the SMC) $\LREL$. %satisfying the adjunction: $\LREL(Z\otimes !_{n}X,Y) \simeq \LREL(Z, !_{n}X\multimap Y)$.

As such, $(\LREL,(!_n)_{n\in\N})$ is a model of graded calculi ensuring bounded duplications via graded typing systems, for instance it is a model  \cite{Katsumata2018} of the language $\BSTLC$, a simplified version of the language $\mathrm{Fuzz}$ \cite{Reed2010}, defined as follows: 
the terms are as for the $\STLC$, the types are $A::= * \ \mid  \ !_{n}A \multimap A$, the contexts of the typing judgements are sets of declarations of the form $x :_{n}A$, with $n\in \mathbb N$, and the typing rules are: %given in Fig.~\ref{fig:rules}
	\[ \scriptsize \arraycolsep=5pt\def\arraystretch{2.8}
	\begin{array}{cccc}
		\prooftree
		\Gamma \vdash M:A
		\justifies
		\Gamma, x:_{0}B \vdash M:A
		\endprooftree 
		&
		\prooftree
		\Gamma, x:_{n}B, y:_{m} B\vdash M:A
		\justifies
		\Gamma, x:_{n+m}B\vdash M\{x/y\}:A
		\endprooftree 
		&
		\prooftree
		\Gamma, x:_{n} A\vdash M: B
		\justifies
		\Gamma\vdash \lambda x.M: !_{n}A\multimap B
		\endprooftree
		&
		\prooftree
		\Gamma \vdash M: !_nA\multimap B
		\quad
		\Delta\vdash N: A
		\justifies
		\Gamma +n\Delta\vdash MN: B
		\endprooftree
	\end{array}
	\]
where $\Gamma+\Delta$ is defined letting $(\Gamma, x:_{m} A)+( \Delta, x:_{n} A) =  (\Gamma+\Delta), x:_{m+n}A$, and $m\Gamma$ is made all $x:_{mn}A$ for $(x:_{n}A) \in \Gamma$.  
The axiom is $x:_{1}A\vdash x: A$.
The main feature of this language is that if $\vdash \lambda x.M:\,!_nA\multimap B$, then $x$ is duplicated at most $n$ times in the reduction of $\vdash (\lambda x.M)N :B$ to the normal form.
%E.g., $\vdash_{\BSTLC} \lambda {\color{red}z}.\left( \lambda x{\color{green}y}. yxx \right)z : \, !_{\color{red}2} *\multimap !_{\color{green}1}(!_{\color{violet}1} * \multimap !_{\color{blue}1} * \multimap *) \multimap *$.
%Observe that one can always type an affine term like e.g.~$\lambda xy.x$ with a linear type $A\multimap B\multimap A$. Instead, a term like $\lambda xy.x(xy)$ containing two occurrences of $x$ cannot be given the linear type $(A\multimap A)\multimap (A\multimap A)$ but a type of the form
%$!_{2}(A\multimap A)\multimap (A\multimap A)$. 

%\begin{remark}\label{rmk:ModelsOfBSTLC}
%Similarly to It is known {\color{red}(([reference??] e dire meglio)} 

Remark that since arrow types are interpreted via $\model{!_{n}A\multimap B}:= !_{n}\model A \times \model B$, 
if $\model *$ is finite, then $\model{A}$ is a finite set for any type $A$ of $\BSTLC$.
%\end{remark}
%Bounded types are interesting because of the following proposition:
%\begin{proposition}
%For all bounded types $A,B$, the morphisms from $\model A$ to $\model B$ (in all parametric relational models) correspond to polynomials.
%\end{proposition}
%\begin{proof}
%It suffices to check that $\model A$ is finite for all bounded types $A$. Indeed this implies that a morphism $t:\model A\to \model B$ is a finite matrix $t: \model A \times \model B \to \Lawv$.Hence, its corresponding map $\widehat t:\Lawv^{\model A} \to \Lawv^{\model B}$ is a polynomial.
%\end{proof}

%For example (here $!_{n}(\Lawv^{X}):= \Lawv^{\C M_{\leq n}(X)}$):
%\begin{itemize}
%\item a map $f\in \LREL( !_{1}\Lawv, \Lawv)$ is of the form $f(x)=\min \{x+a,b\}$;
%\item a map $f\in \LREL(!_{2}\Lawv, \Lawv)$ is a ``quadratic'' polynomial $f(x)=\min\{2x+a, x+b, c\}$.
%\end{itemize}

\begin{comment}

\begin{figure*}

	\scriptsize
	
	\[ \arraycolsep=5pt\def\arraystretch{2.8}
	\begin{array}{cccc}
		\prooftree
		\Gamma \vdash M:A
		\justifies
		\Gamma, x:_{0}B \vdash M:A
		\endprooftree 
		&
		\prooftree
		\Gamma, x:_{n}B, y:_{m} B\vdash M:A
		\justifies
		\Gamma, x:_{n+m}B\vdash M\{x/y\}:A
		\endprooftree 
		&
		\prooftree
		\Gamma, x:_{n} A\vdash M: B
		\justifies
		\Gamma\vdash \lambda x.M: !_{n}A\multimap B
		\endprooftree
		&
		\prooftree
		\Gamma \vdash M: !_nA\multimap B
		\quad
		\Delta\vdash N: A
		\justifies
		\Gamma +n\Delta\vdash MN: B
		\endprooftree
		\\
		\\
		\hline
		\\
		\prooftree
		\Gamma, x: A\vdash M: B
		\justifies
		\Gamma\vdash \lambda x.M: A\to B
		\endprooftree 
		&
		\prooftree
		\Gamma \vdash M: A\to B
		\quad
		\Gamma\vdash \mathbb T: A
		\justifies
		\Gamma \vdash M\mathbb T: B
		\endprooftree 
		&
		\prooftree
		\Gamma \vdash M: A\to B
		\quad
		\Gamma \vdash N: A
		\justifies
		\Gamma \vdash \Diff{M}{N}: A\to B
		\endprooftree
		&
		\prooftree
		\Gamma\vdash M_1: A
		\,\cdots\,
		\Gamma \vdash M_n:A
		\justifies
		\Gamma \vdash M_1+\cdots +M_n : A
		\using (n\geq 2)
		\endprooftree
	\end{array}
	\]
	\caption{Typing rules (axiom rules are given in the text) for $\BSTLC$ (top) and $\STDLC$ (bottom).}\label{fig:rules}
\end{figure*}

\end{comment}

\paragraph*{Controlled duplication/erasure via resources: the differential $\lambda$-calculus $\STDLC$}\label{sec:STDLC}

A Cartesian closed differential $\lambda$-category (CC$\partial\lambda$C)\cite{Manzo2010,Blute2009, Blute2019} is a CCC enriched over commutative monoids %(i.e.\ we can add morphisms and there is a $0$ morphism)
%, it is Cartesian closed%(with the closed structure compatible with the additive structure)
and equipped with a certain \emph{differential operator} $D$, generalising the usual notion of differential, see e.g.\ \cite{BluteEhrhTass10}.
%An example is the CC$\partial\lambda$C of convenient vector spaces with smooth maps, where $D$ is the ``real'' differential $Df:\mathbb{V}\times\mathbb{V}\rightarrow \mathbb{W}$, $Df(x,u):=\dfrac{d}{dt}{\!\Big|_{t=0}} f(x+tu)$, of smooth maps $f:\mathbb{V}\rightarrow \mathbb{W}$.
%More precisely, a cartesian category $\C C$ is a $C\partial C$ when:
%\begin{itemize}
%\item $\C C$ is left-additive, i.e.~its hom-sets have the structure of commutative monoids, and the cartesian structure is well-behaved w.r.t.~this monoid structure;
%\item $\C C$ is equipped with a differential operator $D:
%\C C(X,Y)\to \C C(X\times X,Y)$ satisfying some axioms which capture usual properties of differentials (e.g.~the linearity of $D$ in one of its two variables, the chain rule, etc.).
%\end{itemize}
Now, applying \cite[Theorem 6.1]{lemay2020} one can check that
%\begin{proposition}[{\color{red}LEMAY??}]\label{thm:LREL!CCDC}
 $\LREL_!$ becomes a CC$\partial\lambda$C when equipped with the \emph{tropical differential operator} $D:\HOM{\LREL}{!X}{Y}\to \HOM{\LREL}{!(X\& X)}{Y}$ defined as $(Dt)_{\mu\oplus\rho,b}=t_{\rho+\mu,b}$ if $\#\mu=1$ and as $\infty$ otherwise (using the iso $(\mu,\rho)\in !Z\times !Z'\mapsto\mu\oplus\rho \in !(Z+Z')$).
%\end{proposition}
%\begin{remark}For $t\in\HOM{\LREL}{!X}{Y}$, we have: $D^2 t\in\HOM{\LREL_!}{(X+X)+(X+X)}{Y}$, where $(D^2 t)_{(\rho\oplus\rho')\oplus(\nu\oplus\nu'),b}$ equals $t_{\nu+\nu'+\rho',b}$ if $\rho=\emptyset$ and $\#\rho'=1=\#\nu$; it equals $t_{\rho+\nu',b}$ if $\rho'=\emptyset=\nu$ and $\#\rho=1$; it equals $\infty$ otherwise.\end{remark}
%This ensures that one can define a sound interpretation of $\STDLC$-terms in the standard way (see [Section 4.3, \cite{Manzo2010}]).

As such, $(\LREL_!,D)$ is a model of the differential $\lambda$-calculus $\STDLC$ \cite{ER}, a language ensuring exact control of duplications via a notion of linear substitution.
Its syntax (e.g.\ \cite[Section 3]{Manzo2010}) is given by the \emph{terms} $M$ and the \emph{sums} $\mathbb T$, mutually generated by: $M::= x\mid \lambda x.M \mid M\mathbb T \mid \Diff{M}{M}$ and $\mathbb T::= 0 \mid M \mid M+\mathbb T$,
quotiented by $\alpha$-equivalence, by equations that make $+,0$ form a commutative monoid on the set of sums, %, i.e.\ commutativity and associativity of $+$ and neutrality of $0$ w.r.t.\ $+$;
by linearity of $\lam x.(\_)$, $\Diff{\_}{\_}$ and $(\_)\mathbb T$ (but \emph{not} of $M(\_)$) and by irrelevance of the order of consecutive $\Diff{\_}{\_}$.
%Remark that $M(\_)$ is \emph{not} set to be linear: $\lambda x.0=0\mathbb T=\Diff{0}{N}=\Diff{M}{0}=0$ but $M0\neq0$ in general.
%This is crucial for the definition of the Taylor expansion.
We follow the tradition of quotienting also for the idempotency of $+$.
%Sums are, then, just \emph{finite} sets of terms.
The types are $A::= *\mid A\to A$, the typing rules: %in Figure~\ref{fig:rules}
	\[ \scriptsize \arraycolsep=5pt\def\arraystretch{2.8}
	\begin{array}{cccc}
		\prooftree
		\Gamma, x: A\vdash M: B
		\justifies
		\Gamma\vdash \lambda x.M: A\to B
		\endprooftree 
		&
		\prooftree
		\Gamma \vdash M: A\to B
		\quad
		\Gamma\vdash \mathbb T: A
		\justifies
		\Gamma \vdash M\mathbb T: B
		\endprooftree 
		&
		\prooftree
		\Gamma \vdash M: A\to B
		\quad
		\Gamma \vdash N: A
		\justifies
		\Gamma \vdash \Diff{M}{N}: A\to B
		\endprooftree
		&
		\prooftree
		\Gamma\vdash M_1: A
		\,\cdots\,
		\Gamma \vdash M_n:A
		\justifies
		\Gamma \vdash M_1+\cdots +M_n : A
		\using (n\geq 2)
		\endprooftree
	\end{array}
	\]
where a context $\Gamma$ is a list of typed variable declarations.
The axioms are $\Gamma, x:A \vdash x: A$ and $\Gamma\vdash 0:A$.
The main feature of this language is that $\Der^n[\lambda x.M,N^n]0$ has a non-zero normal form iff $x$ is duplicated exactly $n$ times during the reduction to normal form.
%In $\BSTLC$ the typing system handles duplications; in $\STDLC$ the syntax with its operational semantics (that we do not give) does it.
\begin{comment}
Writing $\Der^2[\_,(\_)^2]$ as a shortcut for $\Der[\Der[\_,\_],\_]$ and $\Der^1[\_,(\_)^1]$ for $\Diff{\_}{\_}$, the analogue of the previous $\BSTLC$-term is $\vdash_{\STDLC} \lambda {\color{red}z}. \Der^{\color{red}2}[
	\lambda x{\color{green}y}.
		\Der^{\color{violet}1} [
				\Der^{\color{blue}1} [y, x^{\color{blue}1}]
        0, x^{\color{violet}1}
	]0
, z^{\color{red}2}]0
: {\color{red}*}\to ({\color{green}* \to * \to *}) \to *$.
%Here we wrote $\Der^2[\_]\cdot (\_)^2$ as a shortcut for $\Der[\Der[\_]\cdot (\_)]\cdot (\_)$ and $\Der^1[\_]\cdot (\_)^1$ for $\Der[\_]\cdot (\_)$.
In particular, if the \emph{multiplicities} of the arguments (the colored exponents) do not exactly match the number of duplications, e.g.\ in $\vdash_{\STDLC} \lambda z. \Der^{\color{red}3}[
	\lambda xy.
		\Diff{
				\Diff{y}{x}
		0}{x}
	0
, z^{\color{red}3}]0
: *\to (* \to * \to *) \to *$, then the term reduces to the empty sum $0$ (representing an \emph{error}).
\end{comment}
%Correspondingly, the syntax of the simply typed \emph{differential} $\lambda$-calculus ($\STDLC$) is defined by enriching $\STLC$ with a monoid structure $0,+$ over terms, as well as with $\Der$ and a notion of \emph{linear substitution} (see \cite{difflambda} or the Appendix for details).

%Until now we simply specialised well-known results in our tropical case, with the intent of showing how things read in this particular case.
%Now we go further, by showing that $\LREL_!$ actually admits a \emph{differential structure}, turning it into a model of the $\STDLC$, i.e.~a $CC\partial C$.
%This viewpoint
%, is where the \emph{metric} and the \emph{differential} viewpoints converge, as explained in the Introduction and Section II, and it % will be further generalised in Section \ref{section6}.

%A model of the $\STDLC$ is usually understood as so-called \emph{Cartesian closed differential categories} (CC$\partial$C), see \cite{Manzo2012} for details.
%In order to treat the $+$ and the constructor $D[\_]\cdot (\_)$ of $\STDLC$, the main features of a CC$\partial$C $\C C$ are that:
%
%1) $\C C$ is a left-additive-CCC, i.e.\ its Homsets are commutative monoids and its Cartesian closed structure is well behaved w.r.t.\ this monoid structure;
%
%2) $\C C$ is equipped with a differential operator map $D:\HOM{\C C}{X}{Y}\to \HOM{\C C}{X\times X}{Y}$ (here $\times$ is the Cartesian product of $\C C$) satisfying $8$ axioms, called D1, ..., D7, D-curry.

%Let us show the differential structure of $\LREL_!$ (remember that the Cartesian product of $\LREL_!$ is the disjoint union $+$).

%\begin{definition} The \emph{tropical differential operator} is the map $D:\HOM{\LREL}{!X}{Y}\to \HOM{\LREL}{!(X+X)}{Y}$ defined as $(Dt)_{\mu\oplus\rho,b}=t_{\rho+\mu,b}$ if $\#\mu=1$ and as $\infty$ otherwise (where a multiset $\nu \in !(X+X)$ is identified with a disjoint sum of $\mu,\rho\in !X$).\end{definition}

%The models of $\STDLC$ are the cartesian \emph{closed} differential categories ($CC\partial C$), which are defined as $C\partial C$ which are also cartesian closed, and in which the monoid structure and the differential operator are both well-behaved with respect to the closed structure \cite{Manzo2012}. 


 

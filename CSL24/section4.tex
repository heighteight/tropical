% !TEX root = /Users/paolopistone/Documents/GitHub/tropicalnew/CSL24/main.tex


As seen in Section \ref{section2}, tropical polynomials are piecewise-linear functions, hence concave and Lipschitz-continuous. Moreover, tps in finitely many variables are locally equivalent to tropical polynomials (except at some singular points), and are thus also concave and locally Lipschitz-continuous.
In this section we show that much of these properties extend also to tps with infinitely many variables, as those arising from the tropical relational model. %establish some topological and metric properties of tps, this way highlighting the rich and interesting topological and metric structure of the category $\LREL_{!}$.
The literature on tropical power series is often recent (e.g.~\cite{Porzio2021}), and several results we prove in this section are, to our knowledge, new.
%
%Remark that the map $(\_)^!$ is a surjective homomorphism (w.r.t.\ coKleisli composition and identity and function composition and identiy) on its image. {\color{red}In Ehrhard-Danos fanno vedere (Lemma 14) che \`e anche iniettivo. Non riesco a capire se anche a noi lo \`e, ma non vedo perch\'e non dovrebbe.}
%Remark that, since $\model{(x_i:A_i)_{i=1}^n\vdash_{\STLC} M:B}\in\HOM{\LREL_!}{\mathlarger{\&}_{i=1}^n \model{A_i}}{\model B}\simeq\Lawv^{\prod_{i=1}^n ! \model {A_i}\times \model B}$, the tps $\model{(x_i:A_i)_{i=1}^n\vdash_{\STLC} M:B}^!:\Lawv^{\mathlarger{+}_{i=1}^n \model{A_i}}\to\Lawv^{\model B} \simeq \prod_{i=1}^n\Lawv^{\model{A_i}}\to\Lawv^{\model B}$ has shape $t^!(x^1,\dots,x^n)_b=\inf_{\mu_i\in ! \model{A_i}}\left\{\sum_{i=1}^n\mu_i x^i+t_{(\mu_1,\dots,\mu_n),b}\right\}$.
%Same for $\STDLC$.
%
%\begin{remark}
%The interpretations of $\BSTLC$-terms are matrices $t\in\HOM{\LREL}{\bigotimes_{i=1}^n !_{n_i}X_i}{Y}=\Lawv^{\prod_{i=1}^n !_{n_i}X_i\times Y}$.
%In such situation, we define $t^!:\Lawv^{\mathlarger{+}_{i=1}^n X_{i}}\to\Lawv^Y \simeq \prod_{i=1}^n\Lawv^{X_{i}}\to\Lawv^Y$ as $t^!(x^1,\dots,x^n)_b:=\inf_{\mu_i\in !_{n_i} X_i}\left\{\sum_{i=1}^n\mu_i x^i+t_{(\mu_1,\dots,\mu_n),b}\right\}$.
%Clearly $t^!={\widetilde t}^!$, where $\widetilde t\in\Lawv^{\prod_{i=1}^n ! {X_i}\times Y}$ is the matrix $\widetilde t_{(\mu_1,\dots,\mu_n),b}:=t_{(\mu_1,\dots,\mu_n),b}$ if $\mu_i\in !_{n_i} X_i$ for all $i$, and $:=\infty$ otherwise, which has the same support as $t$.
%So, such $t^!$'s are special cases of tps and thus we can \emph{Wlog} only consider tps's.
%\end{remark}

%
%In this section we study the tropical Laurent series $\Lawv^X\to \Lawv ^Y$ from the viewpoint of analysis.


% 
% , i.e.~for a \emph{finite} set $\C F\subseteq \, !X$.
%%Remark that we also find usual \emph{tropical polynomials} of tropical geometry as a particular case: they 
%correspond to the tps for which the support $\set{n\in\N\mid\widehat f(n)\neq\infty}$ of $\widehat f$ is \emph{finite}. 
%Actually, for us \emph{tropical polynomial} will mean a function 
%\end{remark}

%
%%In Example~\ref{ex:famous_ex}, 
%Again by looking at Fig~\ref{fig:plot1} it appears that, \emph{far from $0$}, $\varphi$ behaves like some polynomials $\varphi_{n}$.
%In particular, %for all $\epsilon >0$, $f$ coincides on $[\epsilon,\infty]$ with some polynomial $\varphi_{n}$. More, precisely, 
%$\varphi$ coincides on $[\epsilon,\infty]$ with $\varphi_{n}$,
%for $\epsilon \geq 2^{-(n+1)}$ (the smallest tropical root of $\varphi_{n}$).
%However, at
%%
%%$x\in [\epsilon,\infty]$, with $\epsilon>0$
%%It can be proven by hand that $\varphi(x)$ is a $\min$ for all $x>0$.
% $x=0$ we have that $\varphi(x=0)=\inf_{n\in\N} 2^{-n}=0$, and this is the only point where the $\inf$ is \emph{not} a $\min$.
%Also, while the derivative of $f$ is bounded on all $(0,\infty)$, for $x\to 0^+$ it tends to $\infty$.
%This phenomenon is reminiscent of \cite[Example 7]{Ehrhard2005},
%%Differentials and Distances in Probabilistic Coherence Spaces. FSCD 2019
%which actually motivated our first investigations.
%In fact, this behaviour is shared by all tps with \emph{finitely} many variables, as shown by the following result (we identify $!\set{1,\dots,k}\simeq \N^k$, so the matrix of a tps $f$ with finitely many variables $x=x_1,\dots,x_k$ (and one output variable) is given as a $\matr f:\N^k\to\Lawv$, $f$ having shape $f(x)=\inf_{n\in \N^k}\set{nx+\matr f(n)}$, with $nx$ the scalar product).
%
%\begin{theorem}\label{theorem:fepsilon}
% Let $k\in\N$ and $f:\Lawv^k\to\Lawv$ a tps with matrix $\matr f:\N^k\to\Lawv$.
% For all $0<\epsilon<\infty$, there is a \emph{finite} $\C F_\epsilon \subseteq \N^k$ such that 
%% 
%% \begin{enumerate}
%%  \item If $\C F_\epsilon=\emptyset$ then $f=\infty$ on all $\Lawv^k$;
%%  \item If $f(x_0)=\infty$ for some $x_0\in[0,\infty)^k$, then $\C F_\epsilon=\emptyset$;
%  %\item 
%$f$ coincides on all $[\epsilon,\infty]^k$ with the tropical \emph{polynomial} $P_\epsilon(x):=\min_{n\in \C F_\epsilon}\set{nx+\matr f(n)}$.
%% \end{enumerate}
%\end{theorem}
%\begin{proof}[Proof sketch]
%Let $\C F_\epsilon$ be the set of $n\in\N^{k}$ such that 
%$\widehat f(n)<\infty$ and $\widehat f(m)> \widehat f(n)+\epsilon$ holds for all $m\prec n$, where $\preceq$ is the pointwise order on $\N^k$.
%The core of the proof is showing that this set is indeed finite and enough for computing $f$.
%\end{proof}
%
In the remainder of this section, by a tropical polynomial or power series we mean one with possibly infintely many variables. Moreover, we consider the sets $\Lawv^X$ endowed with the usual sup-norm $\norm{x}_\infty:=\sup_{a\in X} x_a$. 

\subparagraph*{Continuity of tps}\label{subsec:cont}%$\Lawv^{X}$ as a normed cone}

Looking at Fig~\ref{fig:plot1}, we see that $\varphi$, just like the polynomials $\varphi_{n}$, is non-decreasing and concave.
This is indeed always the case:

\begin{proposition}\label{prop:nondecr+conc}
 All tps 
 %$f:\Lawv^X\to\Lawv^Y$
are non-decreasing and concave, w.r.t.\ the pointwise order on $\Lawv^{X}$.
\end{proposition}


The tps $\varphi$ is continuous on $\BB R_{\geq0}$ (w.r.t.\ the usual norm of real numbers).
We can generalise this property, dropping the case of $x$ having some $0$ coordinate.
But we have to be careful, because while in the finite dimensional $\BB R^n$, every real convex function is continuous because it is necessarily locally bounded from above (the sup-norm and the euclidean one are equivalent) \cite[Proposition 4.7]{Cobzas2017}, in infinite dimensions the former condition is no longer true \cite[Example 4.8]{Cobzas2017}.
However, \cite[Proposition 4.4.(3)]{Cobzas2017} shows that it is the only requirement to ask: if a real-valued convex function with domain a convex open subset of a locally convex topological $\BB R$-vector space (LCTVS) is, locally around any point, bounded from above by a finite non-zero constant, then it is continuous on all its domain.

\begin{theorem}\label{thm:cont}
 All tps $f:\Lawv^X\to\Lawv$ are continuous on $(0,\infty)^X$, w.r.t.\ to the norm $\norm{\cdot}_\infty$.
\end{theorem}
\begin{proof}
%It follows after adapting \cite[Proposition 4.4]{Cobzas2017} in order to prove that if a real-valued function on a locally convex topological $\BB R$-vector space is, locally around $x$, concave and bounded by a finite constant, then it is continuous at $x$.
%Now, our $f$ is concave, so 
By \autoref{prop:nondecr+conc}, $-f$ is convex.
Since $f\geq 0$ on all $\Lawv^X$, we have e.g.\ $-f\leq 1$ on $\Lawv^X$.
%Remark that we cannot immediately apply \cite[Proposition 4.4.(3)]{Cobzas2017}, since $\Lawv^X$ is not even a $\BB R$-vector space.
Now $(0,\infty)^X\subseteq \BB R^X$ is open and convex, %and {\color{red}$\BB R^X$ is a LCTVS}, 
so \cite[Proposition 4.4.(3)]{Cobzas2017} entails the continuity of $-f$ on $(0,\infty)^X$, hence that of $f$ on it.
\end{proof}

We conclude this subsection by noticing that $\Lawv^X$ with the usual $+$ and the usual $\cdot$ is a $\BB R_{\geq0}$-semimodule.
Together with the norm $\norm{\cdot}_\infty$, it can be proved that it is a Scott-complete \emph{normed cone} (see~\cite{Selinger2004}, or the appendix, for such notions).
Its cone structure induces an order on it, called the \emph{cone order}:
$x\leq y$ iff $y=x+z$ for some (unique) $z\in\Lawv^X$.
Such order actually coincides with the pointwise order on $\Lawv^X$.
This makes it a Scott-continuous dcpo.
Suitable categories of cones have been recently investigated as models of probabilistic computation (\cite{Crubillie2018, EhrPagTas2018, Ehrhard2020}).
In analogy with \cite[Proposition 17]{DanEhrh2011}, we have:

\begin{theorem}\label{thm:ScottCont}
 All monotone (w.r.t.\ pointwise order) and $\norm{\cdot}_{\infty}$-continuous functions $f:(0,\infty)^X\to (0,\infty)$ are Scott-continuous.
 In particular, all tps $f:\Lawv^X\to\Lawv$ are Scott-continuous on $(0,\infty)^X$ w.r.t.\ the pointwise orders.
\end{theorem}
%\begin{proof}
% From \autoref{thm:cont} plus the fact, taken from \cite{Selinger2004}, that in a normed $\R_{\geq 0}$-cone $P$, considered with its cone-order, if every bounded directed net in $P$ admits a sup, and if $(v_i)_{i\in I}$ is a directed net in $P$ with an upper bound $v\in P$, then $\exists\bigvee_{i\in I} v_i \in P$ and, if $\inf_{i\in I} \norm{v-v_i} =0$, one has $\bigvee_{i\in I} v_i = v$.
%\end{proof}



\subparagraph*{Lipschitz-continuity of tps}\label{sec:4C}%$\Lawv^{X}$ as a metric space.}


%The norm $\norm{\cdot}_\infty$ naturally induces a metric $\norm{x-y}_{\infty}$ over the spaces $\Lawv^{X}$.
%We will show that tps satisfy suitable Lipschitz properties w.r.t.\ $\norm{\cdot}_\infty$. 

Let us first look at what happens with those tps which are either \emph{linear} or obtained via bounded exponentials.
The result below is in analogy with what happens in the usual metric semantics of Fuzz, where 
linear functions are non-expansive and $n$-bounded functions are $n$-Lipschitz \cite{Reed2010}.


\begin{proposition}\label{prop:troplinear}
\begin{enumerate}
\item If a tps $f: \Lawv^{X}\to \Lawv^{Y}$ arises from a matrix $\matr f:X\times Y\to \Lawv$ (i.e.~it is linear), then $f$ is non-expansive (i.e.\ $1$-Lipschitz).  
\item If  $f: \Lawv^{X}\to \Lawv^{Y}$ arises from a matrix $\matr f: \ !_{n}X\times Y\to \Lawv$, then $f$ is $n$-Lipschitz-continuous.
\end{enumerate}
\end{proposition}
\begin{proof}[Proof sketch]
1). Using the fact that $f( x)_{b}= \inf_{a\in X}\{\matr f_{a,b}+ x_{a}\}$,
the problem reduces to checking that $|(\matr f_{a,b}- x_{a})- (\matr f_{a,b}- y_{a})| = |x_{a}- y_{a}|\leq \|  x- y\|_{\infty}$ (see the Appendix).

2.) Follows from 1.~and the remark that, for all $x\in \Lawv^{X}$, $\norm{ !_{n} x-!_{n} y}_{\infty}\leq n\cdot \norm{ x- y}_{\infty}$, where $!_{n} x$ is the restriction of $! x$ to $\C M_{\leq n}(X)$.%
\end{proof} 
%\begin{proof}
%Using $f(\B x)_{b}= \inf_{a\in X}\matr f_{a,b}+\B x_{a}$,
%first observe that $|(\matr f_{a,b}-\B x_{a})- (\matr f_{a,b}-\B y_{a})| = |\B x_{a}-\B y_{a}|\leq \| \B x-\B y\|_{\infty}$; we now have
%$|f(\B x)_{b}-f(\B y)_{b}| \leq |(\inf_{a\in X}\matr f_{a,b}-\B x_{a})-(\inf_{a\in X}\matr f_{a,b}-\B y_{a})| \leq
%\sup_{a\in X}|(\matr f_{a,b}-\B x_{a})- (\matr f_{a,b}-\B y_{a})|\leq 
% \| \B x-\B y\|_{\infty}$.
%\end{proof}

%Before looking at what happens in the case of non-linear programs, let us make the metric structure of $\LREL$ explicit. 
The following proposition provides a useful characterization of the functional metrics in $\LREL$, relying on 
the bijection between $\HOM{\LREL}{X}{Y}$ and set of tropical linear functions from $\Lawv^{X}$ to $\Lawv^{Y}$.
Remember that $d_\infty(f,g):=\sup_{a\in X} d_\infty(f(x),f(y))$.

\begin{proposition}
For all $f,g\in \LREL_{!}(X,Y)$, $d_{\infty}( f,g)=d_\infty(f^{!},g^{!})$.% $\norm{ \matr f-\matr g}_{\infty} =  \sup_{x\in \Lawv^{X}} \norm{ f( x)-g(x)}_{\infty}$.
\end{proposition}

%Let us now consider the case of bounded exponentials:
%\begin{proposition}\label{prop:boundedlip}
%If a tps $f: \Lawv^{X}\to \Lawv^{Y}$ arises from a matrix $\matr f:!_{n}X\times Y\to \Lawv$, then $f$ is $n$-Lipschitz-continuous.
%\end{proposition}
%\begin{proof}[Proof sketch]
%This follows from Proposition \ref{prop:troplinear} and the remark that, for all $x\in \Lawv^{X}$, $\norm{ !_{n} x-!_{n} y}_{\infty}\leq n\cdot \norm{ x- y}_{\infty}$, where $!_{n} x$ is the restriction of $! x$ to $\C M_{\leq n}(X)$.%
%%Using the fact that $f(\B x)_{b}=\inf_{\mu\in \C M_{\leq n}(X)}\{ \matr f_{\mu,b}+ \mu (!_{n}\B x) \}$, where $!_{n}\B x\in \Lawv^{\C M_{\leq n}(X)}$ is given by 
%%$(!_{n}\B x)_{[a_{1},\dots, a_{k}]}=\sum_{i=1}^{k}\B x_{a_{i}}$, 
%%it suffices to check that $\| (!_{n}\B x)-(!_{n}\B y)\|_{\infty}\leq n\cdot \| \B x-\B y\|_{\infty}$ and apply Proposition \ref{prop:troplinear}.
%\end{proof}
%This result is perfectly analogous to what happens in the metric models discussed in Section \ref{section2}, the bounded exponentials $!_{n}$ playing the role of the re-scaling trick.


Observe that, for any tropical polynomial $\varphi:\Lawv^{X}\to \Lawv^{Y}$, the associated matrix has shape $!_{\mathrm{deg}(\varphi)}(X)\times Y\to \Lawv$ (as a monomial $\mu_ix+c_{i}$ yields a matrix entry on $!_{\#\mu_i}X\times Y$). Hence, using Proposition \ref{prop:troplinear} 2., we have:
\begin{corollary}\label{prop:polylip}
For any tropical polynomial $\varphi:\Lawv^{X}\to\Lawv$, $\varphi$ is $\mathrm{deg}(\varphi)$-Lipschitz continuous.
\end{corollary}

We now show that, if we consider the \emph{full} exponential $!$, i.e.~arbitrary tps, we can still prove that a local Lipschitz condition holds. %First observe that, as a consequence of Theorem~\ref{theorem:fepsilon}, the tps with \emph{finitely many} variables are always \emph{locally} Lipschitz on all $(0,\infty)^X$. Yet, for the case of infinitely many variables we need a more general argument.
In \cite[Theorem 6.4]{Cobzas2017} a locally Lipschitz property is obtained for locally convex topological vector spaces, under the hypothesis of continuity. \cite[Proposition 6.5]{Cobzas2017} shows that continuity is used in order to have a locally bounded condition, the crucial ingredient of the proof.
Instead of showing how our case fits into such theorems, we prefer to state the following theorem, basically a particular case of \cite[Theorem 6.9, Lemma 6.10]{Cobzas2017}:
%, already fitting in the topics under consideration in this paper.

\begin{theorem}\label{thmTLSlocLip}
%Let $f:V\subseteq (\BB R^X,d) \to (\BB R,\absv \cdot)$, with $V$ open and convex and $d$ any metric.
%If $f$ is concave and locally bounded, then $f$ is locally Lipschitz.
%Moreover, the Lipschitz constant of $f$ on $\overline{B_{\delta}(x)}$ can be chosen to be $\frac{1}{\delta}\max_{\overline{B_{3\delta}(x)}} \absv f$.
%Therefore, since $(0,\infty)^X$ is open and convex in $(\BB R^X,\norm\cdot)$, %and all tps are non-negative, 
%we immediately have that 
All tps $f:\Lawv^X\to\Lawv$ are locally Lipschitz on $(0,\infty)^X$.
Moreover, the Lipschitz constant of $f$ on $\overline{B_{\delta}(x)}$ can be chosen to be $\frac{1}{\delta}\max_{\overline{B_{3\delta}(x)}} f$.
\end{theorem}
\begin{proof}
By observing that $(0,\infty)^X$ is open and convex in $(\BB R^X,\norm\cdot)$, we apply the result that for all $f:V\subseteq (\BB R^X,d) \to (\BB R,\absv \cdot)$ concave and locally bounded, with $V$ open and convex and $d$ any metric, $f$ is locally Lipschitz, with the stated Lipschitz constant on $\overline{B_{\delta}(x)}$. %
% Moreover, the Lipschitz constant of $f$ on $\overline{B_{\delta}(x)}$ can be chosen to be $\frac{1}{\delta}\max_{\overline{B_{3\delta}(x)}} \absv f$.
\end{proof}
%\begin{proof}[Proof]
% Call $\overline{B_{\delta}(x)}:=B_1$, $\overline{B_{3\delta}(x)}:=B_3$.
% It suffices to show that for all $x\in V$, there is $\delta>0$ s.t.\ $B_3\subseteq \mathrm{interior}(V)$, $K:=\max_{B_3}  \absv f$ exists and $f_{\big|_{B_1}}$ is $(\frac{1}{\delta}\max_{B_3} \absv f)$-Lipschitz.
%A $\delta$ satisfying the first two conditions exists since $V$ is open and bcause $f$ is locally bounded and $B_3$ is compact.
%Now fix $y,z\in B_1$.
%Call $r:=\frac{d(y,z)}{2\delta}\in[0,1]$.
%We have to show that $\absv{f(y)-f(z)}\leq \frac{K}{\delta}d(y,z)=2Kr$.
%Wlog $y\neq z$.
%So $r\neq 0$ and we can consider $u:=\frac{1+r}{r}z-\frac{1}{r}y$, $v:=\frac{1}{r}y-\frac{r-1}{r}z$.
%We have $u,v\in \overline{B_{2\delta}(z)}=:B_2$ (geometrically, those are the intersections between $B_2$ and the segment between $y$ and $z$).
%Now we have the convex combinations $z=\frac{1}{1+r}y+\frac{r}{1+r}u$ and $y=(1-r)z+rv$, so the concavity of $f$ entails on one hand:
%$f(z)\geq \frac{1}{1+r}f(y)+\frac{r}{1+r}f(z)\geq \frac{f(y)}{1+r} - \frac{rK}{1+r}$, i.e.\ $f(y)-f(z)\leq r(K+f(z))\leq 2rK$, and on the other hand:
%$f(y)\geq (1-r)f(z)+rf(v)\geq f(z)-r(f(z)+K)$, i.e.\ $f(z)-f(y)\leq r(f(z)+K)\leq 2rK$.
%The last inequalities follow because $B_2\subseteq B_3$.
%Putting those together, we have the thesis.
%\end{proof}

%\subparagraph*{Tropical differential of tps}
%We conclude this section with a few observations on the differential operator over tps.
%The differential operator $D$ of $\LREL_{!}$ translates into a differential operator $D_{!}$ turing a tps $f:\Lawv^{X}\to \Lawv^{Y}$ into a tps $D_{!}f:\Lawv^{X}\times \Lawv^{X}\to \Lawv^{Y}$, linear in its first variable, and given by 
%$D_{!}f(x,y)_{b}=\inf_{a\in X, \mu\in !X}\left\{\matr f_{\mu+a}+x_{a}+\mu y\right\}$. One can check that, when $f$ is a tropical polynomial, $D_{!}f$ coincides with the standard tropical derivative (see e.g.~\cite{Grigoriev2017}).
%Moreover, the Taylor formula \eqref{eq:taylorcat} yields a ``tropical'' Taylor formula for tps of the form 
%$f(x)=\inf_{n}\left\{D_{!}^{(n)}(f)(!_{n}x,\infty)\right\}$. 
%
%The following result shows that the distance between two tropical maps can be approximated using the terms appearing in their Taylor expansions:
%\begin{proposition}
%For all tps $f,g: \Lawv^{X}\to \Lawv^{Y}$, and for all $n\in \BB N$, 
%the functions $x\mapsto D_{!}^{(n)}(f)(!_{n}x,\infty)$ are $n$-Lipschitz. Moreover 
%$\norm{ \matr f-\matr g}_{\infty}= \sup_{n} \norm{ {\delta^{(n)}f}- {\delta^{(n)}g}}_{\infty}$, 
%where $\delta^{(n)}h$ indicates the matrix of $D_{!}^{(n)}h$.
%%where $\delta^{(n)}f:( \Lawv^{X})^{n}\to \Lawv^{X}$ is the tropical linear function $\delta^{(n)}f(\B x_{1},\dots, \B x_{n})=
%%(\Der^{(n)}f)(\B x_{1},\dots, \B x_{n}, \infty)$. 
%\end{proposition} 

\begin{comment}

\subsection{The tropical interpretation of high-order programs}\label{subsec:tro_int}



Rcall that the Taylor expansion $\Te{MN}$ of $MN$ is the set $\set{\Der^{n}[t,u_1,\dots,u_n]0 \mid n\in\N,t\in\Te{M},u_i\in\Te{N}}$.
%One defines its interpretation as $\model{\Te{MN}}:=\inf_{n\in\N,t\in\Te{M},u_i\in\Te{N}} \model{\Der^{n}[t,u_1,\dots,u_n]0}$.
$\LREL_!$ is also well-behaved w.r.t.\ the Taylor expansion, as expressed by the following two results.
First, it can be patientely checked that in $(\LREL_!,D)$ all morphisms can be Taylor expanded  (see \cite[Definition 4.22]{Manzo2012}):

\begin{theorem}\label{thm:modelsTaylor}
 For all $t\in\HOM{\LREL_!}{Z}{X\multimap Y}$, $s\in\HOM{\LREL_!}{Z}{X}$ we have:%, the evaluation of $t$ over $s$ yields 
 \begin{align}\label{eq:taylorcat}
  \RM{ev}\circ_!\langle t,s\rangle =
  \inf\limits_{n\in\N}
  \set{((\dots((\Lambda^- t)\star s)\star \dots)\star s)\circ_! \langle \RM{id},\infty \rangle}.
 \end{align} 
\end{theorem}
%It is worth discussing the formula above a bit more. 
Here,
%:\HOM{\LREL}{!Z}{X\multimap Y}\to \HOM{\LREL}{!(Z+X)}{Y}$
%$\star:\HOM{\LREL}{!(Z+X)}{Y}\times\HOM{\LREL}{!Z}{X}\to \HOM{\LREL}{!(Z+X)}{Y}$ is defined as 
$u\star s= (Du)\circ_{!} \langle \langle  \infty, s\circ_{!} \pi_{1}\rangle,\mathrm{id}\rangle$ corresponds to the application of the derivative of $u$ on $s$, and $\Lambda^-$ is the uncurry operator.
Hence the right-hand term in \eqref{eq:taylorcat} corresponds to the $\inf$ of the $n$-th derivative of $\Lambda^{-}t$ applied to ``$n$ copies'' of $s$,  i.e.~it coincides with the tropical %interpretation of the
version of the usual Taylor expansion.
%Moreover, since $\LREL_!$ has countable sums (all $\inf$'s converge), and thanks to equation \eqref{eq:taylorcat}, an immediate adaptation of the proof of [Theorem 4.23, \cite{Manzo2012}] entails that the interpretation of the $\STDLC$-Taylor expansion of a $\STLC$-term $M$ given in \eqref{eq:taylor}, converges to the interpretation of $M$.
Second, since $\LREL_!$ has countable sums (all countable $\inf$s converge), an immediate adaptation of the proof of \cite[Theorem 4.23]{Manzo2012} shows:

\begin{corollary}\label{cor:T(M)=M}
 For $\Gamma\vdash_{\STLC} M:A$, we have %$\model{\Gamma\vdash_{\STDLC} \Te M:A}:=
$\model{\Gamma\vdash_{\STLC} M:A}=\inf_{t\in\Te{M}} \model{\Gamma\vdash_{\STDLC} t:A}$. %the interpretation of the Taylor expansion of a $\STLC$-term $M$, given in \eqref{eq:taylor}, converges to the one of $M$.
\end{corollary}

%More formally, the differential operator $\Der[-]$ transforms a function $M:A\to B$ into a function $\Der[M]: A\to (A\to B)$ which is linear in its first argument. 
%Since $M$ may rather ask for several copies of $N$, this requires a form of non-determinism: 
%For example, if $M$ is the term $\lambda fx.f(fx)$ considered before, $\Der[M]$ takes a first input $N$ and passes it linearly to $M$. Notice that there are two ways of doing so, corresponding to the two bound occurrences of $f$ in $M$: either by applying $N$ to $fx$, or by 
%applying $f$ linearly to $Nx$ (indeed, if $f$ were applied in an unrestricted way, it might duplicate $Nx$, so that $N$ would not be used linearly). This justifies the equation below, in which $\Der[M]$ is identified with the non-deterministic sum of the two possible linear choices:
%\begin{align}
%\Der\left[\lambda f x.f(fx)\right]\cdot N = 
%\lambda fx. N(fx) + \left(\Der[f]\cdot (Nx)\right)(fx)
%\end{align}
%More generally, one can define a notion of $k$-bounded application $\Der^{(k)}[M]\cdot N^{k}$, where $\Der^{(0)}[M]\cdot N^{0}= M$ and $\Der^{(k+1)}[M]\cdot N^{k+1}= \Der[ \Der^{(k)}[M]\cdot N^{k}]\cdot N$, corresponding to passing $N$ to $M$ exactly $k$ times.
%
%
%The name ``differential'' for the operator $\Der[-]$ is justified by the fact that it satisfies many properties of the usual differential operator of analysis $\Der[f]:= \lambda xy. \frac{\mathsf df(y)}{\mathsf dy}\cdot x$. Notably, it is additive in its first variable (i.e.~it commutes with the non-deterministic sum operator), and satisfies the chain rule.
%Most famously, the differential operator can be used to define a Taylor formula for $\lambda$-terms, which decomposes an unrestricted application into a formal non-deterministic sum of bounded applications:

%
%More generally, the relational semantics interprets unbounded programs as \emph{analytic functions}, that is, as functions admitting a representation as power series. For instance, observing that an analytic map $f: \BB R\to \BB R$, where $f(x)=\sum_{n}\widehat f_{n}\cdot x^{n}$ is uniquely determined by the sequence $\widehat f_{n}$, the program $M_{\infty}:=\lambda fx.fx: (\BB R\To \BB R)\To (\BB R\To \BB R)$ is represented by the power series below:
%\begin{align}
%F_{\infty}(f,x)= \sum_{n=0}^{\infty} \widehat f_{n} x^{n}
%\end{align}
%By restricting ourselves to bounded applications, the terms in the power series become finite, that is, the interpretation becomes a \emph{polynomial}: for instance, the program $M_{2}:=\lambda fx. \sum_{i=0}^{2}\Der^{(i)}[f]\cdot x^{i}$, corresponding to passing $x$ \emph{at most twice} to $f$, is represented by the polynomial
%\begin{align}
%F_{\leq 2}(f,x)=\widehat f_{2} x^{2}  + \widehat f_{1}x +  \widehat f_{0} 
%\end{align}
% In this framework the differential operator is naturally represented by formal differentiation of polynomials, where, as one would expect, 
% $\Der[\sum_{n}a_{n}x^{n}]=\sum_{n}\Der[a_{n}x^{n}]$ and $\Der[a_{0}x^{0}]=0$ and $\Der[a_{n+1}x^{n+1}]= (n+1)a_{n+1}x^{n}$, so that power series can be Taylor expanded. 

Let us now see what the results proved in the previous section translate into, when referred to the interpretation of higher-order programs.
Remark that the metric spaces $(\Lawv^{\mathlarger{+}_{i=1}^n X_i},d_{\infty})$ and $(\prod_{i=1}^n \Lawv^{X_i},\max_{i=1}^n d^{X_i}_\infty)$ are trivially isometric, so we identify them.

% Since $\model{(x_i:A_i)_{i=1}^n\vdash_{\STLC} M:B}\in\HOM{\LREL_!}{\mathlarger{\&}_{i=1}^n \model{A_i}}{\model B}\simeq\Lawv^{\prod_{i=1}^n ! \model {A_i}\times \model B}$, the tps $\model{(x_i:A_i)_{i=1}^n\vdash_{\STLC} M:B}^!:\Lawv^{\mathlarger{+}_{i=1}^n \model{A_i}}\to\Lawv^{\model B} \simeq \prod_{i=1}^n\Lawv^{\model{A_i}}\to\Lawv^{\model B}$ is defined by $t^!(x^1,\dots,x^n)_b:=\inf_{\mu_i\in ! \model{A_i}}\left\{\sum_{i=1}^n\mu_i x^i+t_{(\mu_1,\dots,\mu_n),b}\right\}$.
%Finally, the interpretations of $\BSTLC$-terms are matrices $t\in\HOM{\LREL}{\bigotimes_{i=1}^n !_{n_i}X_i}{Y}=\Lawv^{\prod_{i=1}^n !_{n_i}X_i\times Y}$.In such situation, we define $t^!:\Lawv^{\mathlarger{+}_{i=1}^n X_{i}}\to\Lawv^Y \simeq \prod_{i=1}^n\Lawv^{X_{i}}\to\Lawv^Y$ as $t^!(x^1,\dots,x^n)_b:=\inf_{\mu_i\in !_{n_i} X_i}\left\{\sum_{i=1}^n\mu_i x^i+t_{(\mu_1,\dots,\mu_n),b}\right\}$. Clearly $t^!={\widetilde t}^!$, where $\widetilde t\in\Lawv^{\prod_{i=1}^n ! {X_i}\times Y}$ is the matrix $\widetilde t_{(\mu_1,\dots,\mu_n),b}:=t_{(\mu_1,\dots,\mu_n),b}$ if $\mu_i\in !_{n_i} X_i$ for all $i$, and $:=\infty$ otherwise, which has the same support as $t$.

\begin{corollary}
Let $\model A$ be a finite set.
\begin{enumerate}
\item $\model{\Gamma \vdash_{\BSTLC} M:B}^!:\prod\limits_{(x_i:_{n_i} A_i)\in\Gamma} \!\!\!\!\!\Lawv^{\model{A_i}} \to \Lawv^{\model B}$ is a \emph{tropical polynomial}, thus (as $\model A$ is finite), a \emph{Lipschitz} function.
\item $\model{\Gamma \vdash_{\STLC} M:B}^!, \model{\Gamma \vdash_{\STLC_\oplus} M:A}^!:\prod\limits_{(x_i: A_i)\in\Gamma} \!\!\!\!\!\Lawv^{\model{A_i}} \to \Lawv^{\model B}$ are \emph{locally} Lipschitz maps.
\item $\Te{M}$ decomposes $\model{\Gamma \vdash_{\STLC} M:A}^!$ as an $\inf_{t\in\Te{M}}\model{\Gamma\vdash_{\STDLC} t:A}^!$ of \emph{tropical polynomials}, thus (as $\model A$ is finite), \emph{Lipschitz} functions.
\end{enumerate}
\end{corollary} 
\begin{proof}
1). Since $\model A$ is finite, also $\model *$ is.
Thus, as we already observed, the interpretation of a bounded term is a tropical polynomial.
Now we apply Corollary~\ref{prop:polylip} to each coordinate of the image, and by taking the maximum Lipschitz constant among the finite number $\mathrm{Card}(\model A)$ of them, we obtain the thesis.
2). It follows immediately from Theorem~\ref{thmTLSlocLip} and the fact that $\model A$ is finite.
3). It follows from \autoref{cor:T(M)=M} plus the easily checked fact that, for $(f_n)_{n\in\N}\subseteq\Lawv^{!X\times Y}$, we have $\left(\inf_{n\in\N} f_n\right)^!:\Lawv^X\to\Lawv^Y$, with $\left(\inf_{n\in\N} f_n\right)^!=\inf_{n\in\N} f_n^!$.
\end{proof}

Remark that the restriction $\model A$ finite is without loss of generality, since by Currying all programs can be seen having type $*$, which is natural to interpret as a singleton.

Remark that, if $Y$ is finite and $f:\Lawv^{\mathlarger{+}_{i=1}^n X_i}\to\Lawv^Y$ is $K$-Lipschitz, then $f:\prod_{i=1}^n \Lawv^{X_i}\to \Lawv^Y$ is $K$-Lipschitz on each of the $n$ variable separately.

A consequence of (3) is that the pointwise distance between two interpretations of programs can always be bounded via Lipschitz tropical polynomial approximants of the initial two programs.
\begin{corollary}
 Let $\Gamma \vdash_{\STLC} M:A$ and $\Delta\vdash_{\STLC} N:B$.
 For all $\epsilon>0$, $x\in\Lawv^{\model \Gamma}$, $b\in\model A$, there exist $t\in\Te{M}$, $u\in\Te{N}$ s.t.\ $\big| \model{\Gamma \vdash_{\STLC} M:A}^!(x)_b - \model{\Delta \vdash_{\STLC} N:B}^!(x)_b \big| \leq 2\epsilon + \big| \model{\Gamma \vdash_{\STDLC} t:A}^!(x)_b - \model{\Delta \vdash_{\STDLC} u:B}^!(x)_b \big|$.
\end{corollary}

\end{comment}

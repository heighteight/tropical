% !TEX root = main.tex

What we will call in this paper the tropical relational model is indeed an instance of a general and well-known construction that yields, for any \emph{continuous} semiring $Q$, a model $\QREL_{!}$ of effectful extensions of the simply typed $\lambda$-calculus and $\mathrm{PCF}$. Let us shortly recall this construction and then discuss how it adapts to model \emph{graded} and \emph{differential} variants of $\STLC$. In the next sections we will instead focus on the peculiar features of the tropical case.

\subparagraph*{As Linear/Non-Linear Algebra on Moduli}
For any \emph{continuous} semiring $Q$ (i.e.~a cpo equipped with an order-compatible semiring structure), one can define a category $\QREL$ of ``$Q$-valued matrices''.
More precisely, $\QREL$ (\cite{Manzo2013} calls it $Q^\Pi$) has sets as objects and set-indexed matrices with coefficients in $Q$ as morphisms, i.e.~$\QREL(X,Y):=Q^{X\times Y}$.
%The identity morphism of $\QREL$ is the identity matrix $I\in Q^{X\times X}$,
% given by $i_{a,a}=1$ and $i_{a,b\neq a}=0$, and
The composition $st\in Q^{X\times Z}$ of $t\in Q^{X\times Y}$ and $s\in Q^{Y\times Z}$ is given by $(st)_{a,c}:=\sum_{b\in Y} s_{b,c}t_{a,b}$ (observe that this series always converges because $Q$ is continuous).
For any set $X$, $Q^X$ is a $Q$-semimodule and we can identify $\HOM{\QREL}{X}{Y}$ with the set of linear maps from $Q^X$ to $Q^Y$, which have shape $f(x)_b=:\sum_{a\in X} \matr f_{a,b}x_a$, for some matrix $\matr f\in Q^{X\times Y}$.
% \begin{remark}
 %Following \cite{Manzo2013, Hofmann2014, Ehrhard2005}, we chose to see a matrix $t$ from $X$ to $Y$ as a map $t:X\times Y\to Q$.
% 
% fix $\HOM{\QREL}{X}{Y}:=Q^{X\times Y}$ with composition $st:X\times Z\to Q$ of $s:Y\times Z\to Q$ and $t:X\times Y\to Q$ defined by $(st)_{a,c}:=\sum_{b\in Y} s_{b,c}t_{a,b}$.
Notice that usual linear algebra conventions correspond to work in $\QREL^{\op}$, %a matrix $X\times Y\to Q$ is usually called a ``$Y\times X$-matrix'', meaning $Y$ rows and $X$ columns
e.g.\ the usual matrix-vector product defines a map $Q^Y\to Q^X$.
Following \cite{Manzo2013, Hofmann2014, Ehrhard2005}, we are instead working with transpose matrices.
$\QREL$ admits a comonad $!$ which acts, on objects, by taking the finite multisets.
Remember that the coKleisli category $\C C_!$ of a category $\C C$ w.r.t.\ a comonad $!$ is the category whose elements are the same of $\C C$, and $\HOM{\C C_!}{X}{Y}:=\HOM{\C C}{!X}{Y}$, with composition $\circ_!$ defined by making use of the co-multiplication of $!$.
Now, although a matrix $t\in\HOM{\QREL_!}{X}{Y}$ yields a linear map $\Lawv^{!X}\to\Lawv^Y$, by exploiting the coKleisli structure we can also ``express it in the base $X$'', which leads to the \emph{non-linear} map $t^{!}.Q^{X}\to Q^{Y}$ defined by the power series
$
t^{!}(x)=t\circ_{!}x : b \mapsto \sum_{\mu\in !X}t_{\mu,b}\cdot x^{\mu}
$, 
where $x^{\mu}= \prod_{a\in x}x_{a}^{\mu(a)}$. 

%\end{remark}

When we instantiate $Q=\Lawv$, we obtain a category $\LREL$ of $\Lawv$-values matrices. As one might expect, this category is tightly related to Lawvere's theory of (generalized) metric spaces. For the moment, let us just observe that a (possibly $\infty$) metric on a set $X$ is nothing but a ``$\Lawv$-valued square matrix'' $d:X\times X\to \Lawv$ satisfying axioms like e.g.~the triangular law.
We will come back to this viewpoint in\autoref{sec:GMS}.

Composition in $\LREL$ %is the tropicalisation of the one defining it in $\QREL$, i.e.
reads as \ $(st)_{a,c}:=\inf_{b\in Y}\set{s_{b,c}+t_{a,b}}$, moreover, the non-linear functions $t^{!}: \Lawv^{X}\to \Lawv^{Y}$ give rise to functions of shape 
$t^!(x)_b=\inf_{\mu\in !X} \set{\mu x+ t_{\mu,b}}$, where $\mu x:=\sum_{a\in X} \mu(a)x_a$, which correspond to the generalisation of tLs with \emph{possibly infinitely} many variables (in fact, as many as the elements of $X$).
By identifying $!\set{*}\simeq \N$ and $\Lawv^{\set{*}}\simeq\Lawv$, the tLs generated by the morphisms in $\HOM{\LREL_!}{\set{*}}{\set{*}}$ are exactly the %functions $f:\Lawv\to\Lawv$ of shape $f(x)=\inf_{n\in\N}\set{nx+\matr f(n)}$, for some $\matr f:\N\to\Lawv$, i.e.\ we recover the 
usual tLs's of one variable. %
%similarly, the linear functions $f:\Lawv^X\to \Lawv^Y$, %induced by matrices
%which we call \emph{tropical linear}, are exactly those of shape $f(x)_b=\inf_{a\in X} \set{\matr f_{a,b}+x_a}$, for some $\matr f\in\Lawv^{X\times Y}$.
%%\end{remark}
For example, the $\varphi$ of \autoref{fig:plot1} is indeed of shape $\varphi=t^!$, for $t\in\Lawv^{!\set{*}\times\set{*}}$, $t_{\mu,*}:=2^{-\# \mu}$.
% Therefore $\LREL_!$ is not a full-complete model of $\STLC$.

\begin{remark}
 Let $X$, $Y$ be sets and let $\langle \_,\_\rangle:X\times Y \to \mathbb{R}$.
 For $f:X\to \mathbb R$, define $f^*:Y\to \mathbb R$ by $f^*(y):= \sup_{x\in X}\{\langle x,y\rangle - f(x)\}$.
 Then for $X=!A$, $Y=\Lawv^A$, where $A$ is a set, and $\langle \mu, y \rangle:= \mu y$, we have $f^!(y)=(-f)^*(-y)$ for all $f\in\Lawv^{!A}$.
 This is precisely the same formal construction yielding the well-known convex conjugate $f^*$ of a function $f$, by taking $X$ any vector space, $Y$ its dual space, and $\langle \_,\_\rangle$ the application bilinear form (acting as the scalar product on coordinates).
 This construction is in turn a generalisation of the Legendre transformation.
% Despite the formal constructions being the same, we ignore for the moment if these could be connected to the study of high-order programs in our setting.
\end{remark}

\subparagraph*{As Tropical Weighted Relational Models for effectful higher-order programs}

The categories $\QREL$ are well-known to yield a model of both probabilistic and non-deterministic versions of $\mathrm{PCF}$ (see e.g.~\cite{Manzo2013, Pagani2018}), which are called \emph{Weighted Relational Models}.
The interpretation of the simply typed $\lambda$-calculus $\STLC$ in $\LREL$ relies on the fact that all categories $\QREL_{!}$ are cartesian closed \cite{Manzo2013}, with cartesian product and exponential objects acting on objects $X,Y$ as, respectively, $X+Y$ and $!X\times Y$. 
Hence, %given an environment $\eta$ associating ground types with sets, 
any typable term $\Gamma \vdash M:A$ gives rise to a morphism 
$\model{\Gamma \vdash M:A}\in \LREL_{!}(\model{\Gamma}, \model{A})$, and thus to a generalized tLs $\model{\Gamma \vdash M:A}^{!}:\Lawv^{\model{\Gamma}}\to \Lawv^{\model{A}}$. 
This interpretation extends to $\mathrm{PCF}$ by interpreting the fixpoint combinator $\mathbf Y$ via the matrices $\mathrm{fix}^{X}= \inf_{n}\big\{\mathrm{fix}^{X}_{n}\big\} \in \Lawv^{  !(!X\times X) \times X  }$, where 
 $\mathrm{fix}^{X}_{0}=0$ and $\mathrm{fix}^{X}_{n+1}= \RM{ev}\circ_{!}\langle \mathrm{fix}_{n}^{X}, \RM{id} \rangle $.
 
 


One can easily check, by induction on a typing derivation, that for any program of $\STLC$ or $\mathrm{PCF}$, the associated matrix is \emph{discrete}, that is, its values are included in $\{0,\infty\}$. Indeed, as suggested in Section \ref{section2}, the actual interest of tropical semantics lies in the interpretation of effectful programs. 
%
%In particular, the \emph{evaluation} morphisms $\RM{ev}$ in $\LREL$ are discrete matrices in $\Lawv^{!(!X\times Y)+X)\times Y}$ given by 
%$\RM{ev}_{[ (\mu,b) ,\mu ] , b }=0$, and being $\infty$ in all other cases, and the coKleisli composition of $s\in\Lawv^{!Y\times Z}$ and $t\in\Lawv^{!X\times Y}$ is the matrix $s\circ_! t\in\Lawv^{!X\times Z}$, $(s\circ_! t)_{\mu,c}:=
%%\begin{align}
%\inf_{n\in\N, b_1\dots,b_n\in Y, \mu = \mu_1+\cdots +\mu_n}
% \left\{s_{[b_1,\dots,b_n],c} + \sum_{i=1}^n t_{\mu_i,b_i}\right\}$.
% For example, setting $\model{A}=\{\star\}$, the interpretation of the $\lambda$-term $\lambda x.\lambda y.xy: (A\to A)\to (A\to A)$ yields the tLs
% $\model{M}^{!}: \Lawv^{\mathbb N}\to \Lawv \to \Lawv$ (recalling that we can identify $\mathcal M_{\mathrm{fin}}(\{\star\})$ with $\mathbb N$) given by 
% $$
% \model{M}^{!}(x)(y)= \RM{ev}^{!}(\langle x,y\rangle)= \inf_{n\in \mathbb N}\big\{ x_{n} + ny\big\}.  
% $$
% Moreover,  
As the homsets $\LREL_{!}(X,Y)$ are $\Lawv$-modules, it is possible to interpret in extensions of $\STLC$ and $\mathrm{PCF}$ comprising $\Lawv$-module operations $\alpha \cdot M$ and $M+N$ \cite{Manzo2013}, by 
letting $\model{\Gamma \vdash \alpha\cdot M:A}=\model{\Gamma \vdash M:A}+\alpha$ and 
$\model{\Gamma \vdash M+N:A}=\min\{\model{\Gamma \vdash M:A},\model{\Gamma \vdash N:A}\}$. 
More precisely, \cite{Manzo2013} considers a language $\mathrm{PCF}^{Q}$ corresponding to $\mathrm{PCF}$ extended with $Q$-module operations, with an operational semantics given by rules $M\stackrel{1}{\to}M'$ for each rule $M\to M'$ of $\mathrm{PCF}$ (here $1$ is the monoidal unit of $Q$) as well as 
$M_{1}+M_{2} \stackrel{1}{\to}M_{i}$ and $\alpha\cdot M \stackrel{\alpha}{\to} M $.
Hence, any reduction $\omega: M\to^{*} N$ is naturally associated with a weight $\mathsf w(\omega)\in Q$.
In particular, from [\cite{Manzo2013}, Theorem V.6] we deduce the following result, which relates the tropical semantics of a program with its best-case operational behavior.  
\begin{proposition}
If $\vdash_{\mathrm{PCF}^{\Lawv}} M:\mathrm{Nat}$, then $\model{\vdash_{\mathrm{PCF}^{\Lawv}} M:\mathrm{Nat}}_{n}=  \inf\big\{ \mathsf w(\omega) \ \big \vert \ \omega : M \to \underline n\big \}$ for all $n\in \mathbb N$.
\end{proposition}

Observe that the two examples shown in Section \ref{section2} can easily be rephrased in the language $\mathrm{PCF}^{\Lawv}$. 
For instance, for the probabilistic example, %for a given valuation $\RM{val}$, one can use a translation %$(M\oplus_{p}N)^{\RM{val}}= \min\{(M^{\RM{val}}+\RM{val}(p)), N^{\RM{val}}+\RM{val}(1-p)\}$, so that the reductions $:M\oplus_{p}N\stackrel{p}{\to} M$ and $M\oplus_{p}N\stackrel{p-1}{\to} N$ translate into a sequence of two reductions $(M\oplus_{p}N)^{\RM{val}} \stackrel{0}{\to} M^{\RM{val}}\stackrel{\RM{val}(p)}{\to} M$ and $(M\oplus_{p}N)^{\RM{val}} \stackrel{0}{\to} N^{\RM{val}}\stackrel{\RM{val}(1-p)}{\to} M$, with the weight of the latter corresponding to the valuation of the weight of the former. 
one can use the translation $(M\oplus_{p}N)^{\circ}= \min\{M^{\circ}+p, N^{\circ}+(1-p)\}$, so that the reductions $:M\oplus_{p}N\stackrel{p}{\to} M$ and $M\oplus_{p}N\stackrel{1-p}{\to} N$ translate into a sequence of two reductions $(M\oplus_{p}N)^{\circ} \stackrel{0}{\to} M^{\circ}\stackrel{p}{\to} M$ and $(M\oplus_{p}N)^{\circ} \stackrel{0}{\to} N^{\circ}\stackrel{1-p}{\to} N^{\circ}$.%, with the weight of the latter corresponding to the valuation of the weight of the former. 

Let $\mathrm{PPCF}$ (for \emph{probabilistic $\mathrm{PCF}$} \cite{Pagani2018}) be standard $\mathrm{PCF}$ extended with the constructor $M\oplus_{p}N$ ($p\in[0,1]$) and its associated reduction rules. From the above discussion we deduce the following:

\begin{corollary}
%For every closed probabilistic term $M$ of type $\mathrm{Nat}$ in $\mathrm{PPCF}$ and $n\in \mathbb N$, 
Let $\vdash_{\mathrm{PPCF}^{\Lawv}} M:\mathrm{Nat}$ and $n\in\N$.
Considering its interpretation as a function of $p,1-p$, we have that $\model{\vdash_{\mathrm{PPCF}^{\Lawv}} M^{\circ}:\mathrm{Nat}}_{n}(-\log(p),-\log(1-p))$%\in \Lawv$ (cf.~Remark \ref{rmk:val_trop})
is the minimum negative log-probability of any reduction from $M$ to $\underline n$, i.e.\ the negative log-probability of (any of) the (equiprobable) most likely reduction path from $M$.
\end{corollary}

Remark that this implies that all solution $p\in[0,1]$ to the equation $-\log w(\omega)= \model{\vdash_{\mathrm{PPCF}^{\Lawv}} M^{\circ}:\mathrm{Nat}}_{n}(-\log(p),-\log(1-p))$ are the values of the probabilistic parameter which make the reduction $\omega$ the most likely.


Finally, \cite{Manzo2013} obtained a similar result for a non-deterministic version of PCF, by translating each term into $\mathrm{PCF}^{\Lawv}$via $(\lambda x.M)^{\circ}=\lambda x.M^{\circ}+1$ and $(\mathbf YM)^{\circ}= \mathbf Y(M^{\circ}+1)$
(\cite{Manzo2013} considers the discrete tropical semiring $\mathbb N\cup\{\infty\}$, but the result obviously transports to $\Lawv$), and in that case \cite[Corollary VI.10]{Manzo2013} gives that $\model{\vdash M^{\circ}:\mathrm{Nat}}_{n}$ computes the minimum number of $\beta$- and $\mathsf{fix}$- redexes reduced in a reduction sequence from $M $ to $\underline n$. 

%\begin{corollary}[cf.~\cite{Manzo2013}, Corollary VI.10]
%For every closed probabilistic term $M$ of type $\mathrm{Nat}$ in non-deterministic $\mathrm{PCF}$ and $n\in \mathbb N$, $\model{M^{\circ}}_{n}$ is the minimum number of $\beta$- and $\mathsf{fix}$- redexes reduced in a reduction sequence from $M $ to $\underline n$. 
%\end{corollary}

%, an instance of the language $\mathrm{PCF}^{\mathcal R}$ of \cite{Manzo2013}, via the translations 
%$(M\oplus_{p}N)^{\circ} =pM^{\circ}\mathtt{or}(1-p)N^{\circ}$ and $(M+N)^{\circ}=M^{\circ}\mathtt{or}N^{\circ}$.
%In particular, 
 

\subparagraph*{Interpreting $\mathbb N$-Graded Types}\label{sec:BSTLC}

We now show how to interpret in $\LREL_{!}$ a graded version of $\STLC$, that we call $\BSTLC$, indeed a simplified version of the well-studied language $\mathrm{Fuzz}$ \cite{Reed2010}. 
The terms of $\BSTLC$ as for the $\STLC$, the types are $A::= * \ \mid  \ !_{n}A \multimap A$, the contexts of the typing judgements are sets of declarations of the form $x :_{n}A$, with $n\in \mathbb N$, and the typing rules are: %given in Fig.~\ref{fig:rules}
	\[ \scriptsize \arraycolsep=5pt\def\arraystretch{2.8}
	\begin{array}{cccc}
		\prooftree
		\Gamma \vdash M:A
		\justifies
		\Gamma, x:_{0}B \vdash M:A
		\endprooftree 
		&
		\prooftree
		\Gamma, x:_{n}B, y:_{m} B\vdash M:A
		\justifies
		\Gamma, x:_{n+m}B\vdash M\{x/y\}:A
		\endprooftree 
		&
		\prooftree
		\Gamma, x:_{n} A\vdash M: B
		\justifies
		\Gamma\vdash \lambda x.M: !_{n}A\multimap B
		\endprooftree
		&
		\prooftree
		\Gamma \vdash M: !_nA\multimap B
		\quad
		\Delta\vdash N: A
		\justifies
		\Gamma +n\Delta\vdash MN: B
		\endprooftree
	\end{array}
	\]
where $\Gamma+\Delta$ is defined letting $(\Gamma, x:_{m} A)+( \Delta, x:_{n} A) =  (\Gamma+\Delta), x:_{m+n}A$, and $m\Gamma$ is made all $x:_{mn}A$ for $(x:_{n}A) \in \Gamma$.  
The axiom is $x:_{1}A\vdash x: A$.
The main feature of this language is that if $\vdash \lambda x.M:\,!_nA\multimap B$, then $x$ is duplicated at most $n$ times in the reduction of $\vdash (\lambda x.M)N :B$ to the normal form.




Now, one can see that the comonad $!$ of $\LREL$ can be ``decomposed'' {\color{red}REF} into a family of ``graded exponentials functors'' $!_n:\LREL\to\LREL$ ($n\in\BB N$), defined on objects by taking multisets of cardinality \emph{at most} $n$. %  lift to functors 
The sequence $(!_n)_{n\in\N}$ gives rise to a so-called \emph{$\N$-graded linear exponential comonad} on (the SMC) $\LREL$. %satisfying the adjunction: $\LREL(Z\otimes !_{n}X,Y) \simeq \LREL(Z, !_{n}X\multimap Y)$.
As such, $(\LREL,(!_n)_{n\in\N})$ yields then a model of $\BSTLC$. Remark that since arrow types are interpreted via $\model{!_{n}A\multimap B}:= !_{n}\model A \times \model B$. Notice that, whenever $\model *$ is finite, the set $\model{A}$ is finite for any type $A$ of $\BSTLC$.


\subparagraph*{Interpreting the Differential $\lambda$-Calculus}\label{sec:STDLC}

%We show that $\LREL_{!}$ also interprets the $\STDLC$,  
A Cartesian closed differential $\lambda$-category (CC$\partial\lambda$C)\cite{Manzo2010,Blute2009, Blute2019} is a CCC enriched over commutative monoids (i.e.\ we can add morphisms and there is a $0$ morphism), with the cartesian closed structure compatible with the additive structure, 
and equipped with a certain \emph{differential operator} $D$, generalising the usual notion of differential, see e.g.\ \cite{BluteEhrhTass10}.
An example is the CC$\partial\lambda$C of convenient vector spaces with smooth maps, where $D$ is the ``real'' differential of smooth maps.
%$Df:\mathbb{V}\times\mathbb{V}\rightarrow \mathbb{W}$, 
%$Df(x,u):=\dfrac{d}{dt}{\!\Big|_{t=0}} f(x+tu)$, of smooth maps $f:\mathbb{V}\rightarrow \mathbb{W}$.
%More precisely, a cartesian closed category $\C C$ is a $C\partial C$ when:
%\begin{itemize}
%\item $\C C$ is left-additive, i.e.~its hom-sets have the structure of commutative monoids, and the cartesian structure is well-behaved w.r.t.~this monoid structure;
%\item $\C C$ is equipped with a differential operator $D:
%\C C(X,Y)\to \C C(X\times X,Y)$ satisfying some axioms which capture usual properties of differentials (e.g.~the linearity of $D$ in one of its two variables, the chain rule, etc.).
%\end{itemize}

Applying \cite[Theorem 6.1]{lemay2020} one can check that
%\begin{proposition}[{\color{red}LEMAY??}]\label{thm:LREL!CCDC}
 $\LREL_!$ is a CC$\partial\lambda$C (see Section \ref{section5bis}) when equipped with the \emph{tropical differential operator} $D:\HOM{\LREL}{!X}{Y}\to \HOM{\LREL}{!(X\& X)}{Y}$ defined as $(Dt)_{\mu\oplus\rho,b}=t_{\rho+\mu,b}$ if $\#\mu=1$ and as $\infty$ otherwise (using the iso $(\mu,\rho)\in !Z\times !Z'\mapsto\mu\oplus\rho \in !(Z+Z')$).
%\end{proposition}
%\begin{remark}For $t\in\HOM{\LREL}{!X}{Y}$, we have: $D^2 t\in\HOM{\LREL_!}{(X+X)+(X+X)}{Y}$, where $(D^2 t)_{(\rho\oplus\rho')\oplus(\nu\oplus\nu'),b}$ equals $t_{\nu+\nu'+\rho',b}$ if $\rho=\emptyset$ and $\#\rho'=1=\#\nu$; it equals $t_{\rho+\nu',b}$ if $\rho'=\emptyset=\nu$ and $\#\rho=1$; it equals $\infty$ otherwise.\end{remark}
%This ensures that one can define a sound interpretation of $\STDLC$-terms in the standard way (see [Section 4.3, \cite{Manzo2010}]).
As such, $(\LREL_!,D)$ is a model of the differential $\lambda$-calculus $\STDLC$ \cite{ER}.

% an extension of $\STLC$ ensuring exact control of duplications via a notion of linear substitution in its operational semantics.
%We will not deal with its operational properties, so let us only give its syntax (see \cite[Section 3]{Manzo2010}): there are \emph{terms} $M$ and \emph{sums} $\mathbb T$, mutually generated by: $M::= x\mid \lambda x.M \mid M\mathbb T \mid \Diff{M}{M}$ and $\mathbb T::= 0 \mid M \mid M+\mathbb T$,
%quotiented by $\alpha$-equivalence, by equations that make $+,0$ form a commutative monoid on the set of sums, %, i.e.\ commutativity and associativity of $+$ and neutrality of $0$ w.r.t.\ $+$;
%by linearity of $\lam x.(\_)$, $\Diff{\_}{\_}$ and $(\_)\mathbb T$ (but \emph{not} of $M(\_)$) and by irrelevance of the order of consecutive $\Diff{\_}{\_}$.
%%Remark that $M(\_)$ is \emph{not} set to be linear: $\lambda x.0=0\mathbb T=\Diff{0}{N}=\Diff{M}{0}=0$ but $M0\neq0$ in general.
%%This is crucial for the definition of the Taylor expansion.
%We follow the tradition of quotienting also for the idempotency of $+$.
%%Sums are, then, just \emph{finite} sets of terms.
%The types are $A::= *\mid A\to A$, the typing rules: %in Figure~\ref{fig:rules}
%	\[ \scriptsize \arraycolsep=5pt\def\arraystretch{2.8}
%	\begin{array}{cccc}
%		\prooftree
%		\Gamma, x: A\vdash M: B
%		\justifies
%		\Gamma\vdash \lambda x.M: A\to B
%		\endprooftree 
%		&
%		\prooftree
%		\Gamma \vdash M: A\to B
%		\quad
%		\Gamma\vdash \mathbb T: A
%		\justifies
%		\Gamma \vdash M\mathbb T: B
%		\endprooftree 
%		&
%		\prooftree
%		\Gamma \vdash M: A\to B
%		\quad
%		\Gamma \vdash N: A
%		\justifies
%		\Gamma \vdash \Diff{M}{N}: A\to B
%		\endprooftree
%		&
%		\prooftree
%		\Gamma\vdash M_1: A
%		\,\cdots\,
%		\Gamma \vdash M_n:A
%		\justifies
%		\Gamma \vdash M_1+\cdots +M_n : A
%		\using (n\geq 2)
%		\endprooftree
%	\end{array}
%	\]
%where a context $\Gamma$ is a list of typed variable declarations.
%The axioms are $\Gamma, x:A \vdash x: A$ and $\Gamma\vdash 0:A$.
%The main feature of this language is that $\Der^n[\lambda x.M,N^n]0$ has a non-zero normal form iff $x$ is duplicated exactly $n$ times during the reduction to normal form.
%In $\BSTLC$ the typing system handles duplications; in $\STDLC$ the syntax with its operational semantics (that we do not give) does it.
\begin{comment}
Writing $\Der^2[\_,(\_)^2]$ as a shortcut for $\Der[\Der[\_,\_],\_]$ and $\Der^1[\_,(\_)^1]$ for $\Diff{\_}{\_}$, the analogue of the previous $\BSTLC$-term is $\vdash_{\STDLC} \lambda {\color{red}z}. \Der^{\color{red}2}[
	\lambda x{\color{green}y}.
		\Der^{\color{violet}1} [
				\Der^{\color{blue}1} [y, x^{\color{blue}1}]
        0, x^{\color{violet}1}
	]0
, z^{\color{red}2}]0
: {\color{red}*}\to ({\color{green}* \to * \to *}) \to *$.
%Here we wrote $\Der^2[\_]\cdot (\_)^2$ as a shortcut for $\Der[\Der[\_]\cdot (\_)]\cdot (\_)$ and $\Der^1[\_]\cdot (\_)^1$ for $\Der[\_]\cdot (\_)$.
In particular, if the \emph{multiplicities} of the arguments (the colored exponents) do not exactly match the number of duplications, e.g.\ in $\vdash_{\STDLC} \lambda z. \Der^{\color{red}3}[
	\lambda xy.
		\Diff{
				\Diff{y}{x}
		0}{x}
	0
, z^{\color{red}3}]0
: *\to (* \to * \to *) \to *$, then the term reduces to the empty sum $0$ (representing an \emph{error}).
\end{comment}
%Correspondingly, the syntax of the simply typed \emph{differential} $\lambda$-calculus ($\STDLC$) is defined by enriching $\STLC$ with a monoid structure $0,+$ over terms, as well as with $\Der$ and a notion of \emph{linear substitution} (see \cite{difflambda} or the Appendix for details).

%Until now we simply specialised well-known results in our tropical case, with the intent of showing how things read in this particular case.
%Now we go further, by showing that $\LREL_!$ actually admits a \emph{differential structure}, turning it into a model of the $\STDLC$, i.e.~a $CC\partial C$.
%This viewpoint
%, is where the \emph{metric} and the \emph{differential} viewpoints converge, as explained in the Introduction and Section II, and it % will be further generalised in Section \ref{section6}.

%A model of the $\STDLC$ is usually understood as so-called \emph{Cartesian closed differential categories} (CC$\partial$C), see \cite{Manzo2012} for details.
%In order to treat the $+$ and the constructor $D[\_]\cdot (\_)$ of $\STDLC$, the main features of a CC$\partial$C $\C C$ are that:
%
%1) $\C C$ is a left-additive-CCC, i.e.\ its Homsets are commutative monoids and its Cartesian closed structure is well behaved w.r.t.\ this monoid structure;
%
%2) $\C C$ is equipped with a differential operator map $D:\HOM{\C C}{X}{Y}\to \HOM{\C C}{X\times X}{Y}$ (here $\times$ is the Cartesian product of $\C C$) satisfying $8$ axioms, called D1, ..., D7, D-curry.

%Let us show the differential structure of $\LREL_!$ (remember that the Cartesian product of $\LREL_!$ is the disjoint union $+$).

%\begin{definition} The \emph{tropical differential operator} is the map $D:\HOM{\LREL}{!X}{Y}\to \HOM{\LREL}{!(X+X)}{Y}$ defined as $(Dt)_{\mu\oplus\rho,b}=t_{\rho+\mu,b}$ if $\#\mu=1$ and as $\infty$ otherwise (where a multiset $\nu \in !(X+X)$ is identified with a disjoint sum of $\mu,\rho\in !X$).\end{definition}

%The models of $\STDLC$ are the cartesian \emph{closed} differential categories ($CC\partial C$), which are defined as $C\partial C$ which are also cartesian closed, and in which the monoid structure and the differential operator are both well-behaved with respect to the closed structure \cite{Manzo2012}. 
%
%By induction on $M$ %(using that composition and $D$ easily preserve ``booleaness'' and projections and evaluation of  $\LREL$ are boolean)
%one can prove that:
%
%\begin{proposition}\label{prop:descrete}
% For $\BSTLC$ and $\STDLC$ (and thus also for its fragment $\STLC$), we have that $\model{\Gamma\vdash M:A}\in\Lawv^{!\model{\Gamma}\times\model{A}}$ is a \emph{boolean} matrix, i.e.\ actually $\model{\Gamma\vdash M:A}\in\{0,\infty\}^{!\model{\Gamma}\times\model{A}}$.
%\end{proposition}
%
%For example, the $\varphi$ of \autoref{fig:plot1} is not the interpretation of a $\lam$-term, because its matrix is not discrete.
%This can be seen as the fact that such calculi are relatively trivial, from this point of view.
%Even if the interpretation of those languages is trivia, we shall still focus on them in order to set the basis of the further studies and in order to see some already interesting properties of their interpretation.{\color{red}SPIEGARE MEGLIO}
%
%






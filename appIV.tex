


%We already know from Giulio's paper that $\LREL_!$ is a post-linear continuous $\Lawv$-ccc.

\subsection{Section~\ref{sec:3C}: Proof of Theorem~\ref{thm:LREL!CCDC}}

Theorem~\ref{thm:LREL!CCDC} says that $(\LREL_!,D)$ is a $CC\partial C$.
This is proved in Proposition~\ref{propApp:CCDC}.
First we need the following:

\begin{proposition}
$\LREL_!$ is a cartesian closed left-$\Lawv$-additive category.
\end{proposition}
\begin{proof} 
Since $\infty \circ f= f\circ \infty=\infty$ and $\min\{g,h\}\circ f= \min\{g\circ f, h\circ f \}$, $\LREL_!$ is {left-$\Lawv$-additive}.
A morphism $h\in \LREL_!(X,Y)$ that further satisfies $h\circ \min\{f,g\}=\min\{h\circ f, h\circ g\}$ for all object $X'$ and $f,g\in \LREL_!(X',X)$, is called \emph{additive}.
To show that $\LREL_!$ is cartesian closed left-$\Lawv$-additive we must also check that (1) products and projections of additive morphisms are additive, and that (2) $\Lambda(\min\{f,g\})=\min\{\Lambda(f),\Lambda(g)\}$, $\Lambda(\infty)=\infty$, where $\Lambda:\Lawv^{\C M_{\mathsf{fin}}(Z+X)\times Y}\to \Lawv^{\C M_{\mathsf{fin}}(Z)\times( \C M_{\mathsf{fin}}(X)\times Y)}$ is the isomorphism given by
$(\Lambda(f))_{\mu,\nu,y}= f_{\mu\oplus\nu,y}$, where 
 $\mu\oplus\nu$ is defined by $(\mu\oplus\nu)(\langle 0,x\rangle)=\mu(x)$ and $(\mu\oplus \nu)(\langle 1,x\rangle)=\nu(x)$.
	\begin{enumerate}
	\item  Let $f\in \Lawv^{\C M_{\mathsf{fin}}(X)\times Y}$ and $g\in \Lawv^{\C M_{\mathsf{fin}}(X)\times Z}$ be additive; then $\langle f,g\rangle \in \Lawv^{\C M_{\mathsf{fin}}(X)\times (Y+Z)}$, which is defined by 
	$$
	\langle f,g\rangle_{\mu,\langle i,a\rangle}= \begin{cases}
	f_{\mu,a} & \text{ if }i=0\\
	g_{\mu,a} & \text{ if }i=1
	\end{cases}
	$$
	is also additive. Indeed, for all $h\in \LREL_!(X',X)$, 
	in any cartesian category it holds that $\langle f,g\rangle \circ h=\langle f\circ h, g\circ h\rangle$. Now, 
		if $i=0$, then for all $h_{1},h_{2}\in \Lawv^{\C M_{\mathsf{fin}}(X')\times X}$, 
	\begin{align*}
	(\langle f,g\rangle\circ \min\{h_{1},h_{2}\})_{\rho,\langle i,z\rangle}&=
	(\langle f\circ  \min\{h_{1},h_{2}\},g\circ  \min\{h_{1},h_{2}\}\rangle)_{\rho,\langle i,z\rangle} 
	\\
&=	(f\circ \min\{h_{1},h_{2}\})_{\rho, z}\\ &
	= \min\{(f\circ h_{1})_{\rho,z},(f\circ h_{2})_{\rho,z}\} \\
	&=
	\min\{ \langle f\circ h_{1},g\circ h_{1}\rangle_{\rho,\langle i,z\rangle}, 
	\langle f\circ h_{2},g\circ h_{2}\rangle_{\rho,\langle i,z\rangle}
\}
	\\
	& = \min\{ (\langle f,g\rangle\circ h_{1})_{\rho,\langle i,z\rangle},(\langle f,g\rangle\circ h_{2})_{\rho,\langle i,z\rangle}\}	\end{align*}
	and similarly if $i=1$.
	
	Moreover, suppose $f\in \LREL_!(X, Y+Z)$ is additive, and let us show that $\pi_{1}( f)\in \LREL_!(X,Y)$, defined by 
	$
	(\pi_{1}( f))_{\mu,y}= f_{\mu, \langle 0,y\rangle}
	$, is also additive: first observe that $\pi_{1}(f)=\pi_{1}\circ f$, where $\pi_{1}\in \LREL_!(Y+Z,Y)$ is given by $(\pi_{1})_{\mu,y}=0$ if $\mu=[y]\oplus \emptyset$ and is $\infty$ otherwise; moreover, 
	$\pi_{1}(\min\{g,h\})=\min\{\pi_{1}(g),\pi_{1}(h)\}$, since 
	$(\pi_{1}(\min\{g,h\}))_{\mu, y}=(\min\{g,h\})_{\mu, \langle 0,y\rangle}= \min\{g_{\mu, \langle 0,y\rangle},h_{\mu, \langle 0,y\rangle}\}=( \min\{\pi_{1}(g),\pi_{1}(h)\})_{\mu, y}$. Now,
		given $h_{1},h_{2}\in \LREL_!(X',X)$, we have that 
	$\pi_{1}(f)\circ \min\{h_{1},h_{2}\}= (\pi_{1}\circ f)\circ \min\{h_{1},h_{2}\}= \pi_{1}\circ (f\circ \min\{h_{1},h_{2}\})= \pi_{1}\circ \min\{f\circ h_{1},f\circ h_{2}\}= \pi_{1}(\min\{f\circ h_{1},f\circ h_{2}\})= \min\{\pi_{1}(f\circ h_{1}), \pi_{1}(f\circ h_{2})\}= \min\{\pi_{1}(f)\circ h_{1},\pi_{1}(f)\circ h_{2})$.
	
	\item  It is clear then that $\Lambda(\infty)=\infty$, and moreover
	$$
	\Lambda (\min\{f,g\})_{\mu,\nu,y}= \min\{ f,g\}_{\mu\oplus \nu,y}= \min\{f_{\mu\oplus\nu,y},g_{\mu\oplus\nu,y}\}= \min(\Lambda(f),\Lambda(g))_{\mu,\nu,y}
	$$
	
	\end{enumerate}


\end{proof}



For any morphism $f\in \LREL_!(X,Y)$, let us define a morphism $D(f)\in \LREL_!(X+X,Y)$, i.e.~$D(f)\in \Lawv^{\C M_{\mathsf{fin}}(X+X),Y}$, by
$$
D(f)_{\mu,y}=
\begin{cases}
f_{\mu'+x,y}
& \text{ if }\mu=[x]\oplus \mu'
\\
\infty & \text{ otherwise}
\end{cases}
$$



\begin{proposition}\label{propApp:CCDC}
The category $\LREL_!$, endowed with the operator $D$, is a cartesian closed differential category.
\end{proposition}
\begin{proof}
We must check axioms (D1)-(D7) of cartesian differential categories  plus axiom (D-curry) (cf.~\cite{Manzo2012}).
\begin{description}
\item[(D1)]$D(\min\{f,g\})=\min \{D(f),D(g)\}$ and $D(\infty)=\infty$: 
while the latter is obvious, for the former we have 
$D(\min\{f,g\})_{[x]\oplus\nu,y}= \min\{f,g\}_{\nu+x,y}= \min\{f_{\nu+x,y},g_{\nu+x,y}\}=\min\{D(f),D(g)\}_{[x]\oplus \nu,y}$, and if $\mu\neq [x]\oplus \nu$, 
$D(\min\{f,g\})_{\mu,y}= \infty= \min\{\infty, \infty\}=\min\{ D(f),D(g)\}_{\mu,y}$. 
\item[(D2)]
$D(f)\circ \langle \min\{h,k\},v\rangle= \min\{ D(f)\circ \langle h,v\rangle, D(f)\circ \langle k,v\rangle\}$, and $D(f)\circ \langle \infty,v\rangle=\infty$: we can compute
	\begin{align*}
	(D(f)\circ \langle \min\{h,k\},v\rangle)_{\mu,y}&=
	\inf\Big\{ 
	\sum_{i=1}^{n}\min\{h,k\}_{\rho_{i},w_{i}}+
	\sum_{j=1}^{m}v_{\nu_{j},z_{j}}
	+
	f_{[z_{1},\dots, z_{m}]+w,y}\\
&	\qquad\qquad\mid
	\mu=\sum_{i=1}^{n}\rho_{i}+\sum_{j=1}^{m}\nu_{j},	[w]=[w_{1},\dots, w_{n}]
	\Big\}\\
	& 
=	\inf\Big\{ 
	\min\{h,k\}_{\rho,w}+
	\sum_{j=1}^{m}v_{\nu_{j},z_{j}}
	+
	f_{[z_{1},\dots, z_{m}]+w,y}\\
&	\qquad\qquad\mid
	\mu=\rho+\sum_{j=1}^{m}\nu_{j}
	\Big\}\\
	&=	\min\Big\{\inf\big\{ 
	h_{\rho,w}+
	\sum_{j=1}^{m}v_{\nu_{j},z_{j}}
	+
	f_{[z_{1},\dots, z_{m}]+w,y}	\mid
	\mu=\rho+\sum_{j=1}^{m}\nu_{j}\big\}, \\
	& \qquad\qquad \inf\big\{ 
	k_{\rho,w}+
	\sum_{j=1}^{m}v_{\nu_{j},z_{j}}
	+
	f_{[z_{1},\dots, z_{m}]+w,y}	\mid
	\mu=\rho+\sum_{j=1}^{m}\nu_{j}\big\}\Big\}\\
	& = \min\Big\{(D(f)\circ \langle h,v\rangle)_{\mu,y}, (D(f)\circ \langle k,v\rangle)_{\mu,y}\Big\}\\
		& = \Big(\min\big\{D(f)\circ \langle h,v\rangle, D(f)\circ \langle k,v\rangle\big\}\Big )_{\mu,y}
	\end{align*}
	where, in the first equation, the condition $[w_{1},\dots, w_{n}]=[w]$ (i.e.~$n=1$) is forced by the fact that, otherwise, the application of $D(f)$ would give $\infty$. Moreover, we have
\begin{align*}
(D(f) \circ \langle \infty, v\rangle)_{\mu,y}&=\inf\Big\{ 
	\infty+
	\sum_{j=1}^{m}v_{\nu_{j},z_{j}}
	+
	f_{[z_{1},\dots, z_{m}]+w,y}\mid
	\mu=\rho+\sum_{j=1}^{m}\nu_{j}
	\Big\} = \infty
\end{align*}

\item[(D3)] $D(\mathrm{id})=\pi_{1}$, $D(\pi_{i})=\pi_{i}\circ \pi_{1}$: 
recall that $\mathrm{id}_{[x],x}=0$ and $\mathrm{id}_{\mu,x}=\infty$, if $\mu\neq [x]$. 
Moreover $(\pi_{1})_{\mu,x}=0$ if $\mu=[x]\oplus \emptyset$, and is $\infty$ otherwise, and $\pi_{2}$ is defined similarly.
Hence 
$D(\mathrm{id})_{[x]\oplus\nu,y}=\mathrm{id}_{\nu+x,y}$ is $0$ precisely when $x=y$ and $\nu=\emptyset$, and in all other cases is $\infty$. This shows that $D(\mathrm{id})=\pi_{1}$. 

$D(\pi_{1})\in \Lawv^{\C M_{\mathsf{fin}}((X+Y)+(X+Y))\times Y}$ is given by
$D(\pi_{1})
_{
[x\oplus \emptyset] \oplus (\mu\oplus\nu),y
}= (\pi_{1})_{(\mu\oplus\nu)+\langle 0,x\rangle ,y }
$, 
which is 0 precisely when $(\mu\oplus\nu)+\langle 0,x\rangle= y\oplus\emptyset$, i.e.~when 
$x=y$ and $\mu=\nu=\emptyset$; in all other cases one can check that $D(\pi_{1})_{\rho,y}=\infty$, so we conclude $D(\pi_{1})=\pi_{1}\circ \pi_{1}$.
One can argue similarly for $\pi_{2}$.

\item[(D4)] $D(\langle f,g\rangle)=\langle D(f),D(g)\rangle$: 
we have
\begin{align*}
D(\langle f,g\rangle)_{[x]\oplus\mu, \langle 0,y\rangle}& = 
(\langle f,g\rangle)_{\mu+x,\langle 0,y\rangle}= f_{\mu+x,y}= D(f)_{[x]\oplus \mu,y}\\
D(\langle f,g\rangle)_{[x]\oplus\mu, \langle 1,y\rangle}& = 
(\langle f,g\rangle)_{\mu+x,\langle 1,y\rangle}= g_{\mu+x,y}= D(g)_{[x]\oplus \mu,y}
\end{align*}
from which we deduce
$D(\langle f,g\rangle)_{[x]\oplus\mu, \langle i,y\rangle}=\langle D(f),D(g)\rangle_{[x]\oplus\mu, \langle i,y\rangle}$ 
 by the definition of $\langle \_,\_\rangle$.
 If $\rho\neq [x]\oplus\mu$, then
 $D(\langle f,g\rangle)_{\rho, \langle i,y\rangle}=\infty=\langle \infty,\infty\rangle=\langle D(f),D(g)\rangle_{\rho, \langle i,y\rangle}$
 (where the equation $\infty=\langle \infty,\infty\rangle$ is to be read as an equality between the functions $ X+Y\longrightarrow Q$
 defined by $\langle i,y\rangle \mapsto \infty$ and by
 $\begin{matrix}
 \langle 0,x\rangle\mapsto\infty\\
  \langle 1,y\rangle\mapsto\infty
 \end{matrix}$, respectively).
 
\item[(D5)] $D(f\circ g)=D(f)\circ \langle D(g), g\circ \pi_{2}\rangle$: we can compute
\begin{align*}
\Big( D(f)\circ \langle D(g), g\circ \pi_{2}\rangle\Big)_{[x]\oplus\mu,z}
&=
\inf \Big\{
D(g)_{[x]\oplus\mu',w}+
\sum_{i}g_{\mu_{i},w_{i}}+
D(f)_{[w]\oplus [w_{1},\dots, w_{n}],z}\\
&\qquad\qquad \mid
w,w_{i}\in Y, 
 \mu=\mu'+ \sum_{i}\mu_{i},
\Big\}\\
&=
\inf \Big\{
g_{\mu'+x,w}+
\sum_{i}g_{\mu_{i},w_{i}}+
f_{ [w_{1},\dots, w_{n}]+w,z}\\
&\qquad\qquad \mid
w,w_{i}\in Y, 
 \mu= \mu'+\sum_{i}\mu_{i}
\Big\}
\\
&=\inf\Big\{
\sum_{i} g_{\mu_{i},w_{i}} + f_{[w_{1},\dots, w_{n}],z}
\mid
w_{1},\dots, w_{n}\in Y, 
\mu+x=\sum_{i}\mu_{i}
\Big\}
\\
&= (f\circ g)_{\mu+x,y} =D(f\circ g)_{[x]\oplus\mu,z}
\end{align*}
if $\rho\neq [x]\oplus \mu$, then $D(f\circ g)_{\rho,z}=\infty$ and 
from the first equation above it follows that 
also $( D(f)\circ \langle D(g), g\circ \pi_{2}\rangle)_{\rho,z}=\infty$.



\item[(D6)] $D(D(f))\circ \langle \langle g,\infty\rangle,\langle h,k\rangle\rangle=D(f)\circ  \langle g,k\rangle$:
observe that 
\begin{align*}
\Big(D(D(f))\Big)_{[\langle 1,x'\rangle]\oplus([x]\oplus \mu),z}&=
\big(D(f) \big)_{[x]\oplus (\mu+x'),z }= f_{\mu+x'+x,z}\\
\Big(D(D(f))\Big)_{[\langle 0,x\rangle]\oplus (\emptyset \oplus \mu),z}&=
\big(D(f) \big)_{[x]\oplus \mu,z }= f_{\mu+x,z}
\end{align*}
and in all other cases $(D(D(f)))_{\mu,z}=\infty$.
Using this fact we can compute:


{
\small
\begin{align*}
\Big(D(D(f))\circ \langle \langle g,\infty\rangle,\langle h,k\rangle\rangle\Big)_{\mu,z}&=
\min\left\{
\begin{matrix}
\inf\left\{
\begin{matrix}
\infty_{\rho_{1},x'} + h_{\rho_{2},x}+ \sum_{i}k_{\mu_{i},w_{i}}
+
f_{[w_{1},\dots, w_{n}]+x'+x,z}\\
\qquad \mid 
x,x',w_{i}\in Y, 
\mu=\rho_{1}+\rho_{2}+\sum_{i}\mu_{i}
\end{matrix}
\right\},\\
\inf\left\{
\begin{matrix}
g_{\rho,x}+ \sum_{i}k_{\mu_{i},w_{i}}
+f_{[w_{1},\dots, w_{n}]+x,z}\\
\qquad \mid 
x,w_{i}\in Y, 
\mu=\rho+\sum_{i}\mu_{i}
\end{matrix}
\right\}
\end{matrix}
\right\}\\
&=
\inf\left\{
g_{\rho,x}+ \sum_{i}k_{\mu_{i},w_{i}}
+f_{[w_{1},\dots, w_{n}]+x,z}
\mid 
x,w_{i}\in Y, 
\mu=\rho+\sum_{i}\mu_{i}
\right\}\\
&= \Big(D(f)\circ \langle g,k\rangle\Big)_{\mu,z}
\end{align*}
}

\item[(D7)] $D(D(f))\circ \langle\langle \infty,h\rangle, \langle g,k\rangle\rangle= D(D(f))\circ \langle \langle \infty,g\rangle, \langle h,k\rangle\rangle$:
by computations similar to the case above we obtain

{
\small
\begin{align*}
\Big(D(D(f))\circ \langle \langle & \infty,h\rangle,\langle g,k\rangle\rangle\Big)_{\mu,z}\\
%&=
%\inf\left\{
%\begin{matrix}
%h_{\mu',w} + g_{\mu'',x}+ \sum_{i}k_{\mu_{i},w_{i}}
%+
%f_{[w,w_{1},\dots, w_{n}]+x,z}\\
%\infty+ \sum_{i}k_{\mu_{i},w_{i}}
%+f_{[w,w_{1},\dots, w_{n}],z}
%\end{matrix}
%\mid 
%w,w_{i}\in Y, 
%\mu=\mu'+\mu''+\sum_{i}\mu_{i}
%\right\}\\
&=
\inf\left\{
h_{\rho',x'} + g_{\rho,x}+ \sum_{i}k_{\mu_{i},w_{i}}
+
f_{[w_{1},\dots, w_{n}]+x'+x,z}
\mid 
x,x',w_{i}\in Y, 
\mu=\rho'+\rho+\sum_{i}\mu_{i}
\right\}\\
&=
\inf\left\{
g_{\rho,x} + h_{\rho',x'}+ \sum_{i}k_{\mu_{i},w_{i}}
+
f_{[w_{1},\dots, w_{n}]+x+x',z}
\mid 
x,x',w_{i}\in Y, 
\mu=\rho+\rho'+\sum_{i}\mu_{i}
\right\}\\
&=
\Big(D(D(f))\circ \langle \langle\infty,g\rangle,\langle h,k\rangle\rangle\Big)_{\mu,z}
\end{align*}
}

\item[(D-curry)]  \ \ \ \ \  $D(\Lambda(f))=
\Lambda(D(f)\circ \langle \pi_{1}\times \infty, \pi_{2}\times \mathrm{id}\rangle)$:
by observing that both morphisms are 
in $\LREL_!(X+X, Z^{Y})= \Lawv^{\C M_{\mathsf{fin}}(X+X)\times \C M_{\mathsf{fin}}(Y)\times Z}$, 
and that $ \langle \pi_{1}\times \infty, \pi_{2}\times \mathrm{id}\rangle
\in \LREL_!( (X+X)+Y  , (X+Y)+(X+Y) )$,
we can compute:

{\small
\begin{align*}
\big(\Lambda(D(f)\circ \langle&  \pi_{1}\times \infty, \pi_{2}\times \mathrm{id}\rangle)\big)_{[x]\oplus\mu,\nu,z}\\
&=
\big(D(f)\circ \langle \pi_{1}\times \infty, \pi_{2}\times \mathrm{id}\rangle\big)_{([x]\oplus\mu)\oplus\nu, z}\\
&=
\inf\left\{
( \pi_{1})_{[x]\oplus \emptyset,x}+
\sum_{i}(\pi_{2})_{\emptyset\oplus [w_{i}],w_{i}}
+
\sum_{j}(\mathrm{id})_{[z_{j}],z_{j}}
 + D(f)_{([x]\oplus \emptyset)\oplus(\mu\oplus \nu)}
\mid
\begin{matrix}
\mu=[w_{1},\dots, w_{n}],\\
\nu=[z_{1},\dots, z_{m}]
\end{matrix}
\right\}\\
&=
\inf\left\{
0+0
+
0 + D(f)_{([x]\oplus \emptyset)\oplus(\mu\oplus \nu)}
\mid
\begin{matrix}
\mu=[w_{1},\dots, w_{n}],\\
\nu=[z_{1},\dots, z_{m}]
\end{matrix}
\right\}\\
&=
\big(D(f)\big)_{ ([x]\oplus\emptyset)\oplus(\mu\oplus\nu),z}\\
&=
f_{(\mu+x)\oplus\nu, z}\\
& =
\big(\Lambda(f)\big)_{\mu+x,\nu,z}=\big(D(\Lambda(f))\big)_{[x]\oplus\mu, \nu,z}
\end{align*}
}

If $\rho\neq [x]\oplus\mu$, then $(D(\Lambda(f)))_{\rho,\nu,z}=\infty$ and $
(\Lambda(D(f)\circ \langle  \pi_{1}\times \infty, \pi_{2}\times \mathrm{id}\rangle))_{\rho,\nu,z}=
(D(f)\circ \langle \pi_{1}\times \infty, \pi_{2}\times \mathrm{id}\rangle)_{\rho\oplus\nu, z}
$, and one can check that also this is $\infty$, using the second equation above and the fact that $(\pi_{1})_{\rho\oplus\emptyset,x}=\infty$.\end{description}


\end{proof}



%\paragraph{Taylor Expansion }
\subsection{Section~\ref{sec:3C}: proof of  Theorem~\ref{thm:modelsTaylor}}

Theorem~\ref{thm:modelsTaylor} states the validity of Taylor expansion in $\LREL_!$.

We must check for it the following equation, given $f\in \LREL_!(C, B^{A})$ and $g\in \LREL_!(C,A)$:
$$
\mathsf{ev}\circ \langle f,g\rangle= \inf_{n\in \BB N}
\left\{(( \cdots (\Lambda^{-}(f) \underbrace{\star g)\cdots )\star g}_{n\text{ times}})\circ \langle \mathrm{id}, \infty\rangle\right\}
$$
where:
\begin{enumerate}
\item $\mathsf{ev}\in \LREL_!(B^{A}+A, B)$ is the canonical \emph{evaluation} morphism;

\item $\Lambda^{-}(\_):= \mathsf{ev}\circ (\_\times \mathrm{id})$ is the \emph{uncurry} operator;

\item given $f\in \LREL_!(C+A,B)$ and $g\in \LREL_!(C,A)$, 
$f\star g\in \LREL_!(C+A,B)$ is the morphism obtained by differentiating $f$ in its second component and applying $g$ in that component, i.e.~
$$
f\star g =  D(f)\circ \langle \langle \infty, g\circ \pi_{1}\rangle, \mathrm{id}_{C+A}\rangle.
$$ 

\end{enumerate}

We do it in the following $4$ steps.


\begin{enumerate}

\item Let us compute the morphism $\mathsf{ev}$ explicitly: $\mathsf{ev}\in \Lawv^{ \C M_{\mathsf{fin}}(  ( \C M_{\mathsf{fin}}(A)\times B)       +  A    ) \times B  }$ is given by
$$\mathsf{ev}_{\mu,y}=
 \begin{cases}
 0 & \text{ if } \mu=[ \langle\rho, y\rangle]  \oplus \rho \\
 \infty & \text{ otherwise}
 \end{cases}
 $$
and observe that, given $f\in \LREL_!(C, B^{A})$ and $g\in \LREL_!(C,A)$, 
$$
\big(\mathsf{ev}\circ \langle f,g\rangle \big)_{\chi, y}= 
\inf\Big \{ 
\sum_{i=1}^{m}g_{\chi_{i},x_{i}}+
f_{\chi', \langle [x_{1},\dots, x_{m}],y\rangle}
\mid 
x_{1},\dots, x_{m}\in A,
\chi= \chi'+\sum_{i=1}^{m}\chi_{i}, 
\Big \}
$$



\item Let us compute the morphism $\Lambda^{-}$ explicitly: given $g\in \LREL_!(C, B^{A})$, 
$\Lambda^{-}(g)\in \LREL_!(C+A, B)$ is given by 
$$
\big(\Lambda^{-}(g)\big)_{\rho\oplus\mu,y}=g_{\rho, \langle \mu,y\rangle}
$$


\item Let us compute the morphism $\star$ explicitly: $f\star g$ is given by 
$$
(f\star g)_{\rho\oplus\mu,y}=
\inf\Big\{
g_{\rho',x}+
f_{\rho''\oplus(\mu+x)}
\mid
x\in A,
\rho= \rho'+\rho''
\Big\}
$$

\item We can now conclude: given the definition of $\mathsf{ev}\circ \langle f,g\rangle$, to check the Taylor equation it is enough to check that, for all $N\in \BB N$, 
$$
\left((( \cdots (\Lambda^{-}(f) \underbrace{\star g)\cdots )\star g}_{N\text{ times}})\circ \langle \mathrm{id}, \infty\rangle\right)_{\chi,y}=
\inf\Big \{ 
\sum_{i=1}^{N}g_{\chi_{i},x_{i}}+
f_{\chi', \langle [x_{1},\dots, x_{N}],y\rangle}
\mid 
\begin{matrix}
x_{1},\dots, x_{N}\in A,\\
\chi= \chi'+\sum_{i=1}^{N}\chi_{i}
\end{matrix}
\Big \}
$$

Let us show, by induction on $N$, the following equality, from which the desired equality easily descends:
$$
\big(( \cdots (\Lambda^{-}(f) \underbrace{\star g)\cdots )\star g}_{N\text{ times}}\big)_{\chi\oplus\mu,y}=
\inf\Big \{ 
\sum_{i=1}^{N}g_{\chi_{i},x_{i}}+
f_{\chi', \langle\mu+ [x_{1},\dots, x_{N}],y\rangle}
\mid 
\begin{matrix}
x_{1},\dots, x_{N}\in A,\\
\chi= \chi'+\sum_{i=1}^{N}\chi_{i}
\end{matrix}
\Big \}
$$
\begin{itemize}

\item if $N=0$, the right-hand term reduces to 
$f_{\chi, \langle \mu, y\rangle}=(\Lambda^{-}(f))_{\chi\oplus\mu,y}$;

\item otherwise, let $F=(( \cdots (\Lambda^{-}(f) \underbrace{\star g)\cdots )\star g}_{N-1\text{ times}})$, so that by I.H.~we have
$$
F_{\chi\oplus\mu,y}=
\inf\Big \{ 
\sum_{i=1}^{N-1}g_{\chi_{i},x_{i}}+
f_{\chi', \langle\mu+ [x_{1},\dots, x_{N-1}],y\rangle}
\mid 
\begin{matrix}
x_{1},\dots, x_{N-1}\in A,\\
\chi= \chi'+\sum_{i=1}^{N-1}\chi_{i}
\end{matrix}
\Big \}
$$
Then we have
{\small
\begin{align*}
\big( F\star g\big)_{\chi\oplus\mu,y}
&=
\inf \left \{
g_{\chi',x}+F_{\chi''\oplus(\mu+x)}
\mid
x\in A, \chi=\chi'+\chi''
\right\}\\
&=
\inf\left \{ 
g_{\chi',x}+
\inf\left\{
\sum_{i=1}^{N-1}g_{\chi_{i},x_{i}}+
f_{\chi'', \langle\mu+ [x_{1},\dots, x_{N-1}]+x,y\rangle}
\mid 
\begin{matrix}
x_{1},\dots, x_{N-1}\in A,\\
\chi^{*}= \chi''+\sum_{i=1}^{N-1}\chi_{i}
\end{matrix}
\right\}
\ 
\Big\vert \ 
\begin{matrix}
x\in A,\\
\chi=\chi'+\chi^{*}
\end{matrix}
\right \}\\
&=
\inf\Big \{ 
g_{\chi',x}+
\sum_{i=1}^{N-1}g_{\chi_{i},x_{i}}+
f_{\chi'', \langle\mu+ [x_{1},\dots, x_{N-1}]+x,y\rangle}
\mid 
\begin{matrix}
x,x_{1},\dots, x_{N-1}\in A,\\
\chi= \chi'+\chi''+\sum_{i=1}^{N-1}\chi_{i}
\end{matrix}
\Big \}\\
&=
\inf\Big \{ 
\sum_{i=1}^{N}g_{\chi_{i},x_{i}}+
f_{\chi', \langle\mu+ [x_{1},\dots, x_{N}],y\rangle}
\mid 
\begin{matrix}
x_{1},\dots, x_{N}\in A,\\
\chi= \chi'+\sum_{i=1}^{N}\chi_{i}
\end{matrix}
\Big \}.
\end{align*}
}
\end{itemize}
\end{enumerate}

\subsection{Section~\ref{sec:3C}: The language and the semantics of the $\STDLC$}\label{secApp:STDLC}

The language we mainly consider in the paper is the differential $\lambda$-calculus $\STDLC$, that we briefly define here, following [Section 3, \cite{Manzo2010}].

The \emph{terms} and the \emph{sums}\footnote{Usually what we call here ``terms'' are called ``simple terms'', and what we call here ``sums'' are called ``differential terms''.} are mutually generated by the following grammars:

{
\begin{minipage}{\textwidth}
\begin{align*}
\textit{Terms: } & M,N:= x\mid \lambda x.M \mid M\BB T \mid \Der [M] \cdot N \qquad \textit{(Call $\Lambda^\partial$ the set of such terms)}
\\
\textit{Sums: } & \BB T:= 0 \mid M \mid M+\BB T
\end{align*}\end{minipage}}\medskip\\
quotiented by usual $\alpha$-equivalence plus other equivalences.
Among those, we ask that $+$ is commutative, associative, with neutral element $0$ (thus the name ``sums''), and the constructors $\lam x.(\cdot)$, $(\cdot)\BB T$ and $\Der [\cdot] \cdot (\cdot)$ commute with $+$.
One says that those constructors are \emph{linear}.
Remark that $M(\cdot)$ is \emph{not} set to be linear.
So, while $\lambda x.0=0\BB T=\Der [0] \cdot N=\Der [M] \cdot 0=0$, we have $M0\neq0$ in general.
This is crucial for the definition of the Taylor expansion.
One also needs to quotient for an equation, called ``permutative equality'', which basically says that the order of \emph{consecutive} linear applications $\Der [\cdot] \cdot (\cdot)$ does not count.
Finally, for simplicity we follow here the tradition of ``eliminating the coefficients'', that is, we quotient for the idempotency of the sum.
Sums are, then, just (\emph{finite}) subsets of $\Lambda^\partial$.

Simple types are as usual generated by the grammar:

{
\begin{minipage}{\textwidth}
\begin{align*}
A,B:= X\mid A\to B
\end{align*}\end{minipage}}\medskip\\
where $X$ varies in a fixed set of ground types.

The typing system is given in Figure~\ref{fig:STDLC}.

\begin{figure}
\fbox{
\begin{minipage}{0.9\textwidth}
\begin{center}

  {
\AXC{$(x: A)\in \Gamma$}
\UIC{$\Gamma\vdash x\in A$}
\DP}

\bigskip

\begin{tabular}{c c }
  {
\AXC{$\Gamma, x: A\vdash M: B$}
\UIC{$\Gamma\vdash \lambda x.M: A\to B$}
\DP}

& 

  {
\AXC{$\Gamma \vdash M: A\to B$}
\AXC{$\Gamma\vdash \BB T: A$}
\BIC{$\Gamma \vdash M\BB T: B$}
\DP} 

\end{tabular}

\bigskip

  {
\AXC{$\Gamma \vdash M: A\to B$}
\AXC{$\Gamma \vdash N: B$}
\BIC{$\Gamma \vdash \Der [M] \cdot N: A\to B$}
\DP}

\bigskip

\begin{tabular}{c c }

  {
\AXC{}
\UIC{$\Gamma \vdash 0:A$}
\DP}


& 

  {
\AXC{$\Gamma\vdash M_1: A \quad \cdots \quad \Gamma \vdash M_n:A \qquad (n\geq2)$}
\UIC{$\Gamma \vdash M_1+\cdots +M_n : A$}
\DP}

\end{tabular}
\end{center}
\end{minipage}
}
\caption{Typing rules for $\STDLC$.}
\label{fig:STDLC}
\end{figure}


We finally recall the sound interpretation of $\STDLC$-terms in a $CC\partial C$ category, following [Section 4.3, \cite{Manzo2010}].

\begin{definition}
Let $\C C$ be a $CC\partial C$ and $\model X$ fixed objects of $\C C$, one for each ground type $X$ of the $\STDLC$.

One lifts as usual the interpretation to types and contexts as $\model{A\to B}:=\model A\to \model B$ (the exponential object in $\C C$) and $\model{x_1:A_1,\dots,x_n:A_n}:=\Pi_{i=1}^n\model{x_i:A_i}$.

One inductively defines an interpretation $\model{\Gamma \vdash \BB T:A}\in\C C(\model \Gamma,\model{A})$ of $\Gamma \vdash \BB T:A$ by induction as:
\begin{itemize}
 \item $\model{\Gamma, x:A \vdash x:A}:=\pi_2$
 \item $\model{\Gamma, x:A \vdash y:B}:=\model{\Gamma \vdash y:B}\circ \pi_1\quad\textit{ if } y\neq x$
 \item $\model{\Gamma\vdash \lambda x.M:A\to B}:=\Lambda(\model{\Gamma,x:A\vdash M:B})$
 \item $\model{\Gamma \vdash M\BB T:B}:=\mathsf{ev} \circ \langle \, \model{\Gamma \vdash M:A\to B}, \model{\Gamma \vdash \BB T:A} \, \rangle$
 \item $\model{\Gamma \vdash \Der [M] \cdot N:A\to B}:=\Lambda\left(\Lambda^-(\model{\Gamma \vdash M:A\to B})\star \model{\Gamma \vdash N:A}\right)$
 \item $\model{\Gamma \vdash 0:A}:=:0 \qquad \textit{(the $0$ element of $\C C(\model \Gamma,\model A)$)}$
 \item $\model{\Gamma \vdash M+\BB T:A}:=\model{\Gamma \vdash M:A}+\model{\Gamma \vdash \BB T:A}$ \qquad \textit{(the $+$ operation on $\C C(\model \Gamma,\model A)$)}
\end{itemize}
\end{definition}

One then defines a ``differential'' extension of usual $\beta$-reduction (see again [Section 3, \cite{Manzo2010}], or \cite{difflambda}), and thanks to the fact that $\C C$ is a $CC\partial C$, the interpretation above can can be proved to be sound for it ([Theorem 4.12, \cite{Manzo2010}]).

In the paper we write $\model M$, but of course we mean $\model{\Gamma \vdash M:A}$.




\subsection{Section~\ref{sec:3C}: proof of Corollary~\ref{cor:T(M)=M}}

In the last lines of Section~\ref{sec:3B} we state Corollary~\ref{cor:T(M)=M} which is about the Taylor expansion of a ordinary $\lambda$-terms $M$.
In the main paper we do not define it, let us briefly recall it here, and the we prove the Corollary.
For details, the reader can look at the many papers on the subject pointed in the bibliography.

If sums (as defined in the above lines of Section~\ref{secApp:STDLC}) are \emph{finite} subsets of $\Lambda^\partial$, the Taylor expansion considers in general infinite subsets of $\Lambda^\partial$.
Since we decided to ``eliminate the coefficients'', what we will define is often called the ``qualitative'' Taylor expansion.

\begin{definition}
 
 The (qualitative) \emph{Taylor expansion} is the following inductively defined map $\Theta : \Lambda \to \C P\left(\Lambda^\partial\right)$.
\[\begin{array}{rcl}
 \Te x & := & x \\
 \Te{\lambda x.M} & := & \lambda x.\Te M \\
 \Te{M\BB T} & := & \sum\limits_{n\in\N} \left(\Der^n [\Te M] \cdot \Te{\BB T}^n\right)0
\end{array}\]
where $\Te{M+\BB T}:=\Te M+\Te{\BB T}$ and $\Der^{n+1} [\Te M] \cdot \Te N^{n+1}:=\Der[\Der^n [\Te M] \cdot \Te N^n] \cdot \Te N$.
\end{definition}

We can now prove Corollary~\ref{cor:T(M)=M}.

\begin{theorem}[Corollary~\ref{cor:T(M)=M}]
 In $(\LREL_!,D)$, we have:
 \[ \model M = \model{\Te M} \]
for all $M\in\Lambda$.
\end{theorem}
\begin{proof}
 By induction on $M$.
 We only give the crucial case, that is $M=P\left(\sum\limits_j N_j\right)$.
Looking at the definition of $\model{\cdot}$ we have:
 \[\begin{array}{rclr}
	\model{P(\sum\limits_j N_j)} 
	& = &
	 \mathsf{ev} \circ \langle \, \model{P}, \model{\sum\limits_j N_j}  \, \rangle
	&
	\\
	& = &
	 \inf\limits_{k\in\N}\left\{
	 ((\dots (\Lambda^-(\model{P})\star \model{\sum\limits_j N_j})\cdots ) \star \model{\sum\limits_j N_j} )
	 \circ \langle id,\infty \rangle \right\}
	&
	\textit{(Theorem~\ref{thm:modelsTaylor})}
	\\
	& = &
	 \inf\limits_{k\in\N}\left\{
	 ((\dots (\Lambda^-(\model{\Te P})\star \model{\sum\limits_j \Te N_j})\cdots ) \star \model{\sum\limits_j \Te N_j} )
	 \circ \langle id,\infty \rangle \right\}
	&
	\textit{(ind.\ hyp.)}
	\\
	& = &
	 \inf\limits_{k\in\N}\left\{
	 \mathsf{ev} \circ \langle\, \Lambda\left(
	 (\dots (\Lambda^-(\model{\Te P})\star \model{\sum\limits_j \Te N_j})\cdots ) \star \model{\sum\limits_j \Te N_j}
	 \right) , \infty \, \rangle \right\}
	& \textit{(general property of CCC's)}
	\\
	& = &
	 \inf\limits_{k\in\N}\left\{
	 \mathsf{ev} \circ \langle\, \model{\Der^n [\Te P] \cdot \Te{\sum\limits_j N_j}^n}, \infty \, \rangle \right\}
	&
	\\
	& = &
	 \inf\limits_{k\in\N}\left\{\model{(\Der^n [\Te P] \cdot \Te{\sum\limits_j N_j}^n)0} \right\}
	&
	\\ \\
	& = &
	 \model{\Te{P(\sum\limits_j N_j)}}
	&
 \end{array}\]
\end{proof}





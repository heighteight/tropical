

In this section we illustrate a few directions in which the tropical semantics just introduced could be used to analyze quantitative properties of higher-order programs. 
The general pattern is to consider a program $M$, which can be expressed in the form of a polynomial or a power series, and 
investigate what quantitative properties of $M$ can be deduced from properties of its tropicalization $\trop M$ (which are often easier to study).
By the way, this is the approach taken in several well-studied applications of tropical geometry (e.g.~for optimization problems related to machine learning \cite{}).



\subsection{Best Case Analysis and Metric Reasoning}

The possibility of using the relational model over the tropical semi-ring for ``best case'' resource analysis has already been explored in \cite{Manzo}. Notably, they considered an interpretation of a language for $\B{PCF}$ with non-deterministic choice in which each $\lambda$-abstraction and each occurrence of the fixpoint operator $Y$ is assigned a ``weight'' 1, and showed that for any program $M$ of type $\B{nat}$, 
the value of the interpretation $\model{M}\in \Lawv^{\BB N}$ on a particular natural number $k$, i.e.~$\model{M}(k)\in \Lawv$, corresponds to the \emph{minimum} number of $\beta$- or $\TT{fix}$-redexes reduced in a reductions sequence from $M$ to $\underline n$. 
In the next paragraph we will illustrate an analogous ``best case'' analysis for probabilistic programs.

What does the metric analysis from the previous sections add to that? Firstly, the possibility of \emph{comparing} different programs with respect to their quantitative properties. For example, in the $\B{PCF}$ semantics recalled above, the distance between two programs $M$ and $N$ of type $\B{nat}$, provides a bound on the difference between the  ``best case'' computation time of $M$ and that of $N$. For instance, by taking, instead of the $\infty$-norm metric on $\Lawv^{\BB N}$,  
the \emph{non symmetric} distance (or quasi-metric, a viewpoint we explicitly take in Section \ref{section6}) $q(\B x, \B y)=\sup_{n}\{\B y_{n}\dotdiv \B x_{n}\}$, a ``distance'' $q(\model{M},\model{N})\leq \epsilon$ would indicate that $\model{M}$ \emph{improves} on $\model{N}$ of at most $\epsilon$ steps at each computation. 

Secondly, the Lipschitz conditions studied in the previous section allow us to reason on program distances in a \emph{compositional} way: suppose, as before, that $M,N:A$ are two programs such that $M$ improves on $N$ by $\epsilon$, and let $\TT C[-]:A \to \B{nat}$ indicate a context; knowing that the interpretation of $\TT C$ is $k$-Lipschitz-continuous on some open set containing both $\model M$ and $\model N$, allows us to immediately deduce that $\TT C[M]$ improves on $\TT C[N]$ by $k \epsilon$. 
Observe that this will typically be the case when the Taylor expansions of $\TT C[M]$ and $\TT C[N]$ actually yields a \emph{finite} sum of at most $k$ terms, i.e.~when 
\begin{align}
\TT C[M] = \sum_{i=0}^{k} \TT D^{(k)}\Big[\lambda x.\TT C[x]\Big]\cdot M^{k}
\end{align}
and similarly for $\TT C[N]$. It is here worth recalling that, for $\STDLC$, a well-known result \cite{} is that the Taylor expansion of a closed application $MN$ is always finite, although its non-zero coefficients may be arbitrarily high. 
Notably, these observations suggest to study tropical versions of \emph{finiteness spaces} \cite{}, 
a variant of the relational semantics modeling strongly normalizing programs via \emph{finite} power series.
We mention this point in the Section~\ref{sec:concl}


\subsection{Maslov dequantisation}

{\color{red}MI SA CHE QUESTO PEZZETTO SERVE ANCHE QUI, O NO?}
{\color{red}L'ho scritta qui cos\`i ma non merita una sezione tutta per se, non so se/come vogliamo dire Maslov}
First, let us recall that for any non-negative real $t$, the functions $\phi_{t}(x)=-t\log x$ and $\psi_{t}(\alpha)=e^{-\alpha/t}$ are inverse of each other and define thus continuous (w.r.t.\ the usual topologies) bijections between the space of probabilities $[0,1]$ and $\BB R_{\geq 0}\cup\set{\infty}$ (we write $\log$ for the natural logarithm).
Moreover, if we set $\alpha \widetilde+ \beta:= \frac{\alpha+\beta}{2}$, $\alpha\sumt{t}\beta=\phi_{t}(\psi_{t}(\alpha)\widetilde{+}\psi_{t}(\beta))=-\log (e^{-\alpha/t}+e^{-\beta/t})-\phi_{t}(2)$ and $\alpha\prodt{t} \beta:=\phi_{t}(\psi_{t}(\alpha)\psi_{t}(\beta))=\alpha+\beta$, it is known that: $\lim\limits_{t\to 0}\alpha\sumt{t} \beta= \min\{\alpha,\beta\}$.
In this sense, setting $\Lawv_t:=([0,\infty],\sumt{t},\prodt{t})$, one says that $\Lawv_t\to_{t\to 0^+}\Lawv$.
Moreover, setting $\widetilde\Lawv:=([0,\infty],\widetilde+,\cdot)$, it can be shown that $\Lawv_t\simeq\widetilde\Lawv$ for all $t>0$, so the $\Lawv_t$ are all isomorphic, whereas at the limit we have a discontinuity: it can be shown that $\Lawv_t\not\simeq\Lawv$.
These considerations are called the \emph{Maslov dequantisation} of $\Lawv$ [??].
%Moreover, the two tropical  operations $\min$ and $+$ on $\BB R_{\geq 0}\cup\set{\infty}$ can be obtained via these bijections as the limit of the operations $\alpha\sumt{t}\beta=\phi_{t}(\psi_{t}(\alpha)\widetilde{+}\psi_{t}(\beta))=-\log (e^{-\alpha/t}+e^{-\beta/t})-\phi_{t}(2)$ and $\alpha\prodt{t} \beta=\phi_{t}(\psi_{t}(\alpha)\psi_{t}(\beta))=\alpha+\beta$; we have: $\lim_{t\to 0}\alpha\sumt{t} \beta= \min\{\alpha,\beta\}$ and $\lim_{t\to 0}\alpha\prodt{t}y= \alpha+\beta$. 

\subsection{Tropical Polynomials and Log-Probabilities}

Let us consider in this subsection a probabilistic extension of $\lam$-calculus, adding as usual terms of shape $pM+qN$ and $M\oplus_p N$, for $p,q\in[0,1]$.
These terms are typed via the rule:
\[
 \dfrac{\Gamma\vdash M:A \qquad \Gamma\vdash N:A}{\Gamma\vdash M\oplus_p N:A}
\]
and similar for $\Gamma\vdash pM+qN:A$.
We add the rule:
\[
 M\oplus_p N \to pM+(1-p)N
\]
so that such terms play the role of probabilistic choices of parameter $p$, as well as the rule:
\[
 pM+qM\to (p+q)M.
\]

\begin{remark}
{\color{red}By using [Weighted], it can be shown that $\LREL_!$ still is a model of such calculus. GIUSTIFICARLO BENE ?}
\end{remark}

Let us consider $M:=(I\oplus_p\Omega)\oplus_ps((I\oplus_p\Omega)\oplus_p(I\oplus_p\Omega))$.
Reducing to normal form, we have:
\[
 M\twoheadrightarrow (p^2+(1-p)p^2+(1-p)^3)I+(p(1-p)+2(1-p)^2p)\Omega.
\]
Setting $q:=1-p$, we can consider the two weights of $I$ and $\Omega$ as polynomials in the variables $p$ and $q$, and call
$Q_1(p,q):=P_{00}(p,q)+P_{100}(p,q)+P_{111}(p,q)$ the weight of $I$, while
$Q_2(p,q):=P_{01}(p,q)+P_{110}(p,q)+P_{101}(p,q)$ is the weight of $\Omega$,
where the $P$'s are the following monomials in $p,q$:
$P_{00}(p,q):=p^2$,
$P_{100}(p,q):=qp^2$,
$P_{111}(p,q):=q^3$,
$P_{01}(p,q):=pq$,
$P_{110}(p,q)=P_{101}(p,q):=q^2p$.
The index $\omega\in\set{00,100,111,01,110,101}$ of each $P_\omega$ indicate the path of the reduction that led from $M$ to the respective occurrence of $I_\omega$ of $I$ or $\Omega_\omega$ of $\Omega$ from $M$ to its normal form ($0$ means ``left'' and $1$ means ``right'').
For instance, in order to reach $I_{100}$, i.e.\ the second occurrence of $I$ from the left in $M$, we have to take the right path in the outer $\oplus_p$ of $M$, then two times the left path in the new outer $\oplus_p$'s that we encounter during reduction.
The $P_{100}(p,q):=qp^2$ gives then the probability (as a function of $p,q$) of obtaining such occurrence of $I$ in the normal form if we were to sample at each time we reduce a $\oplus_p$.
Moreover, the polynomials $Q_{1,2}(p,q)$ give the whole probability of obtaining respectively $I$ or $\Omega$, in the normal form after such samplings.

The tropical point of view allows us to express two natural questions about this situation:
\begin{enumerate}
 \item What is the maximum likelihood estimator for the event ``$M$ produces $I_\omega$''?
This means asking what is the choice of the parameters $p,q$ that maximizes the probability of getting $I_\omega$ by reducing $M$.
 \item Knowing that $M$ produced $I$ (similarly for $\Omega$), which occurrence $I_\omega$ is the most likely to have been produced ? I.e., which is the most likely path $\omega$ to have been taken?
\end{enumerate}



\subsection{Resource Analysis for Differential Privacy}

The typical situation in differential privacy is where one considers a probabilistic query $f: \mathsf{db}\to [0,1]^{X}$ over some database, and one requires that $f$ should not be \emph{too sensitive} to small changes in the output, in other to prevent potential leaks of private information about individual items in $\mathsf{db}$ (for instance, an element $x\in\mathsf{db}$ could be the list of students of some university and $f(x)$ indicates the percentage of female students$\mathsf{db}$).

More formally, differential privacy is defined as follows \cite{}:
\begin{definition}
Let $f: \mathsf{db}\to [0,1]^{X}$ and $\epsilon \in \BB R_{\geq 0}$. $f$ is said \emph{$\epsilon$-differentially private} if for all $x,x'\in \mathsf{db}$
differing by $L$ items, for all $s\in X$, 
$$
f(x)(s) \ = \ e^{\epsilon L} f(x')(s)
$$
\end{definition}

A well-studied approach to ensure differential privacy for higher-order programs is to use bounded type systems like $\mathsf{Fuzz}$ \cite{}. Indeed, such systems come with an \emph{a priori} warrant that well-typed programs are Lipschitz.

The use of tropical semantics suggests how resource analysis could also be used to provide bounds for differential privacy. 
Suppose our probabilistic query $f$ can be expressed as a power series (this is what happens e.g.~in \emph{probabilistic coherent spaces} \cite{}). Then, if we discover, either by studying differential properties of $f$, or using methods from convex analysis as suggested in the previous section (e.g.~Theorem \ref{??}), 
 that the tropicalization $\trop f$ satisfies a Lipschitz condition, we may use this fact to deduce that $f$ is differentially private, as shown by the result below.

%
%We have seen how a higher-order probabilistic program, which is expressed as a polynomial, can be tropicalized. This operation can be extended to programs expressed as power series by taking the limit. 
%
\begin{proposition}
Let $f: [0,1]^{X}\to [0,1]^{Y}$ be an analytic function. If $\trop f$ is Lipschitz over some open set $U$, then $f$ is differentially private over $\psi_{t}(U)$, for small enough $t$.
\end{proposition}
\begin{proof}
We consider the case $X=Y=\B 1$ for simplicity. 
Express $f$ as a power series $f(x)=\sum_{n}\psi_{e}(\widehat f_{n})x^{n}$, so that $\trop f(\alpha)= \inf_{n}\left \{
n\alpha + \widehat f_{n}
\right\}$.
Let us define a family of intermediate functions $\trop_{t}f(\alpha)=\phi_{t}(\stackrel{t}{\sum_{n}}\widehat{f}_{n}\times_{t}n\alpha)$. These, by construction, satisfy
\begin{align}\label{eq:phit}
f(\phi_{t}(\alpha)) = \phi_{t}(\trop_{t}f(\alpha))
\end{align}
and, using the fact that $\alpha\sumt{t}\beta\to\min\{\alpha,\beta\}$ and $\alpha\prodt{t}\beta\to \alpha+\beta$, we can deduce that $\trop f(\alpha)=\lim_{t\to 0}\trop_{t}f(\alpha)$ (for this, we use the fact that for all $m\in \BB N$,
$\min_{i\leq m}\alpha_{i}\leq \stackrel{t}{\sum}_{i\leq m}\alpha_{i}\leq 
(\min_{i\leq m}\alpha_{i})+t\log m$).

Now, using the fact that $\trop f$ and $\trop_{t} f$ come arbitrarily close with $t$ small enough, together with \eqref{eq:phit}, the Lipschitz condition  
$|\trop f(\phi_{t}(x))-\trop f(\phi_{t}(y))|\leq L\cdot |\phi_{t}(x)-\phi_{t}(y)|$ translates into the differential privacy condition 
$f(x) \leq e^{L\cdot |\log x-\log y|} f(y)$ (supposing $y\geq x$ and $f(y)\neq 0$).
\end{proof}

%General discussion: optimization properties behave in a Lipschitz way.
%
%
%- differential privacy and Lipschitzness
%
%
%- log-probabilities and tropical roots 
%
%
%- counting computation steps (from Manzonetto, but add relational ``Lipschitz'' reasoning)
%
%
%- measuring duplications of discrete functions (needs finiteness!)



